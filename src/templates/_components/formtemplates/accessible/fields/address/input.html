{# This will wrap the generated HTML for all the address fields #}
<div class="sproutaddress-form">
    {# The select.html file is used for the Country dropdown fields. It will also be used used for the Region dropdown fields if hey exist, in the {{ form }} output below. #}
    {{ countryInput }}

    {# The form output will include several fields that use the text.html and select.html fields. #}
    <div class="meta">
        {{ form }}
    </div>
    {# the hidden.html file will be output here ??? #}
</div>
<script>
    function loadAdministrativeArea(url, el, namespace) {
        var oForm = el.closest('form');

        var csrfValue = oForm.elements["{{ csrfTokenName  }}"].value;

        var data = {namespace: namespace, countryCode: el.value};
        var params = typeof data == 'string' ? data : Object.keys(data).map(
            function(k){ return encodeURIComponent(k) + '=' + encodeURIComponent(data[k]) }
        ).join('&');

        var http = new XMLHttpRequest();

        http.open('POST', url, true);
        http.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
        http.onreadystatechange = function() {

            //Call a function when the state changes.
            if(http.readyState == 4 && http.status == 200) {

                removeElements('.field-address-input', oForm);
                var response = JSON.parse(http.response);
                var meta = oForm.querySelector('.meta');

                meta.innerHTML = response.html;
            }
        };

        http.setRequestHeader('X-CSRF-Token', csrfValue);
        http.setRequestHeader('Accept', 'application/json; charset=utf-8');
        http.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=utf-8');

        http.send(params);
    }

    function removeElements(classes, oForm) {
        var inputs = oForm.querySelectorAll(classes);

        for (var key in inputs) {
            var elem = inputs[key];

            if (typeof elem.parentNode !== 'undefined') {
                elem.parentNode.removeChild(elem);
            }
        }
    }
</script>