{% import "_includes/forms" as forms %}

{{ forms.selectField({
    first: true,
    required: true,
    label: "Section <span class='info'>Create an entry on this section</span>"|t('sprout-forms'),
    id: 'section',
    name: 'section',
    options: sectionsOptions,
    value: integration.section
}) }}

<script>
    $(document).ready(function() {
        console.log("as1");
        init();
        // We have three scenarios:
        // 1.- on load (the init function should load current rows with proper dropdown)
        // 2.- when user add a new row (display the fields dropdown on the new row)
        // 3.- When user update the section dropdown (Update all rows field dropdown)
        $("div.btn.add.icon").on("click", function(){
        });

        function init(){

            $('.craftEntryFields').each(function(){
                var $select = $(this).find('select');
                appendFieldsToSelect($select);
            });
        }

        function appendFieldsToSelect($select) {
            var entryTypeId = $('#types-barrelstrength-sproutforms-integrationtypes-ElementIntegration-section').val();
            var data = {'entryTypeId':entryTypeId};
            Craft.postActionRequest('sprout-forms/integrations/get-entry-fields', data, $.proxy(function(response, textStatus)
            {
                var statusSuccess = (textStatus === 'success');

                if(statusSuccess && response.success) {
                    fields = response.fieldOptions;
                    for (i = 0; i < fields.length; i++) {
                        var field = fields[i];
                        $select.append('<option value="'+field['value']+'">'+field['label']+'</option>');
                    }
                }
                else
                {
                    Craft.cp.displayError(Craft.t('sprout-forms','Unable to get the Entry fields'));
                }
            }, this));
        }
    });
</script>
{% js %}

{% endjs %}



