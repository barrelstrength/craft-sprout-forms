!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/",i(i.s=3)}([,,,function(t,e,i){i(4),i(5),i(6),i(7),i(8),t.exports=i(9)},function(t,e,i){function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}"undefined"===s(Craft.SproutForms)&&(Craft.SproutForms={}),function(t){var e=window.MutationObserver||window.WebKitMutationObserver;e||((e=function(){}).prototype.observe=function(){},e.prototype.disconnect=function(){}),Craft.SproutForms.ConditionalModal=Garnish.Modal.extend({$body:null,$content:null,$main:null,$footer:null,$leftButtons:null,$rightButtons:null,$saveBtn:null,$cancelBtn:null,$deleteBtn:null,$saveSpinner:null,$deleteSpinner:null,$loadSpinner:null,addedDelete:!1,$html:null,$js:null,$css:null,$currentHtml:null,$currentJs:null,$currentCss:null,$observed:null,observer:null,templateLoaded:!1,executedJs:null,loadedCss:null,init:function(i){this.base(),this.setSettings(i,{resizable:!0}),this.$currentHtml=t(),this.$currentJs=t(),this.$currentCss=t(),this.$observed=t(),this.executedJs={},this.loadedCss={},this.observer=new e(t.proxy((function(t){for(var e=0;e<t.length;e++)this.$observed=this.$observed.add(t[e].addedNodes)}),this));var s=t('<form class="modal sprout-field-modal" style="display: none; opacity: 0;">').appendTo(Garnish.$bod);this.$body=t('<div class="body">').appendTo(s),this.$content=t('<div class="content">').appendTo(this.$body),this.$main=t('<div class="main">').appendTo(this.$content),this.$footer=t('<div class="footer">').appendTo(s),this.$loadSpinner=t('<div class="spinner big">').appendTo(s),this.$leftButtons=t('<div class="buttons left">').appendTo(this.$footer),this.$rightButtons=t('<div class="buttons right">').appendTo(this.$footer),this.$deleteSpinner=t('<div class="spinner hidden">').appendTo(this.$leftButtons),this.$deleteBtn=t('<div class="btn delete hidden" role="button">').text(Craft.t("sprout-forms","Delete")).appendTo(this.$leftButtons),this.$cancelBtn=t('<div class="btn disabled" role="button">').text(Craft.t("sprout-forms","Cancel")).appendTo(this.$rightButtons),this.$saveBtn=t('<div class="btn submit disabled" role="button">').text(Craft.t("sprout-forms","Save")).appendTo(this.$rightButtons),this.$saveSpinner=t('<div class="spinner hidden">').appendTo(this.$rightButtons),this.setContainer(s),this.$loadSpinner.addClass("hidden");this.initTemplate({html:"",js:"",css:""})},initTemplate:function(e){var i=t.proxy((function(t){this.$html=t.$html,this.$js=t.$js,this.$css=t.$css,this.templateLoaded=!0,this.initListeners(),this.visible&&this.initSettings(),this.off("parseTemplate",i)}),this);this.on("parseTemplate",i),this.parseTemplate(e)},parseTemplate:function(e){var i=this,s=Garnish.$doc.find("head"),n=t(e.html),a=t(e.js).filter("script"),r=t(e.css).filter("style, link"),o=r.filter("link").prop("async",!0),d=r.filter("style");o.each((function(){var e=t(this),n=e.prop("href");i.loadedCss.hasOwnProperty(n)||(s.append(e),i.loadedCss[n]=e)}));var l=a.filter("[src]"),c=a.filter(":not([src])"),u=[];l.each((function(){var e=t(this).prop("src");i.executedJs.hasOwnProperty(e)||(u.push(e),i.executedJs[e]=!0)}));t.when(this.runExternalScripts(u)).then(function t(){i.off("runExternalScripts",t),i.trigger("parseTemplate",{target:this,$html:n,$js:c,$css:d})}()),this.$deleteBtn.removeClass("hidden"),this.$saveBtn.removeClass("disabled"),this.$cancelBtn.removeClass("disabled")},runExternalScripts:function(e){var i=e.length;if(i>0)for(var s=0;s<e.length;s++){var n=e[s];(n.indexOf("MatrixConfigurator")>=0||n.indexOf("TableFieldSettings.min.js")>=0||n.indexOf("quill.min.js")>=0||n.indexOf("sproutfields.js")>=0||n.indexOf("EditableTable.js")>=0||n.indexOf("initialize.js")>=0)&&t.getScript(n,t.proxy((function(t,e){"success"===e?0===--i&&this.trigger("runExternalScripts",{target:this}):Craft.cp.displayError(Craft.t("sprout-forms","Could not load all resources."))}),this))}else this.trigger("runExternalScripts",{target:this})},initListeners:function(){this.$deleteBtn.addClass("hidden"),this.$cancelBtn.addClass("disabled"),this.$saveBtn.addClass("disabled"),this.addListener(this.$cancelBtn,"activate","closeModal"),this.addListener(this.$saveBtn,"activate","saveConditional"),this.addedDelete||(this.addListener(this.$deleteBtn,"click","deleteConditional"),this.addedDelete=!0),this.on("show",this.initSettings),this.on("fadeOut",this.destroySettings),this.enable()},destroyListeners:function(){this.$cancelBtn.addClass("disabled"),this.$saveBtn.addClass("disabled"),this.removeListener(this.$cancelBtn,"activate"),this.removeListener(this.$saveBtn,"activate"),this.off("show",this.initSettings),this.off("fadeOut",this.destroySettings),this.disable()},initSettings:function(e){var i=e&&e.target?e.target:this;if(i.templateLoaded){i.$currentHtml=e&&e.$html?e.$html:i.$html.clone(),i.$currentJs=e&&e.$js?e.$js:i.$js.clone(),i.$currentCss=e&&e.$css?e.$css:i.$css.clone(),i.$observed=t(),i.observer.observe(Garnish.$bod[0],{childList:!0,subtree:!1}),i.$main.append(i.$currentHtml),Garnish.$bod.append(i.$currentJs),Craft.initUiElements();t.when(i.runExternalScripts(Object.keys(i.executedJs))).then(function t(){i.off("runExternalScripts",t),setTimeout((function(){i.observer.disconnect()}),1)}())}},destroySettings:function(t){var e=t&&t.target?t.target:this;e.$currentHtml.remove(),e.$currentJs.remove(),e.$currentCss.remove(),e.$observed.remove()},closeModal:function(){this.hide()},saveConditional:function(e){if(e&&e.preventDefault(),!this.$saveBtn.hasClass("disabled")&&this.$saveSpinner.hasClass("hidden")){this.destroyListeners(),this.$saveSpinner.removeClass("hidden");var i=this.$container.serialize(),s=this.$container.find('input[name="conditionalId"]');!!s.length&&s.val();Craft.postActionRequest("sprout-forms/conditionals/save-conditional",i,t.proxy((function(e,i){this.$saveSpinner.addClass("hidden");var s="success"===i;if(s&&e.success)this.initListeners(),this.trigger("saveConditional",{target:this,conditional:e.conditional}),Craft.cp.displayNotice(Craft.t("sprout-forms","'{name}' conditional saved.",{name:e.conditional.name})),this.hide();else if(s&&e.template)if(this.visible){var n=t.proxy((function(t){this.initListeners(),this.destroySettings(),this.initSettings(t),this.off("parseTemplate",n)}),this);this.on("parseTemplate",n),this.parseTemplate(e.template),Garnish.shake(this.$container)}else this.initListeners();else this.initListeners(),Craft.cp.displayError(Craft.t("sprout-forms","An unknown error occurred."))}),this))}},editConditional:function(e){this.destroyListeners(),this.show(),this.initListeners(),this.$loadSpinner.removeClass("hidden");var i={conditionalId:e,formId:t("#formId").val()};Craft.postActionRequest("sprout-forms/conditionals/edit-conditional",i,t.proxy((function(e,i){this.$loadSpinner.addClass("hidden");var s="success"===i;if(s&&e.success){var n=t.proxy((function(t){this.destroySettings(),this.initSettings(t),this.off("parseTemplate",n)}),this);this.on("parseTemplate",n),this.parseTemplate(e.template)}else s&&e.error?(Craft.cp.displayError(e.error),this.hide()):(Craft.cp.displayError(Craft.t("sprout-forms","An unknown error occurred. ")),this.hide())}),this))},deleteConditional:function(e){if(e.preventDefault(),this.confirmDeleteConditional()){this.destroyListeners();var i=this.$container.serialize(),s=t(this.$container).find('input[name="conditionalId"]').val();Craft.postActionRequest("sprout-forms/conditionals/delete-conditional",i,t.proxy((function(e,i){"success"===i&&e.success?(Craft.cp.displayNotice(Craft.t("sprout-forms","Conditional deleted.")),t("#sproutforms-conditional-row-"+s).remove(),this.initListeners(),this.hide()):(Craft.cp.displayError(Craft.t("sprout-forms","Unable to delete conditional.")),this.hide())}),this))}},confirmDeleteConditional:function(){return confirm("Are you sure you want to delete this conditional and all of it's settings?")},hide:function(){this._disabled||this.base()},destroy:function(){this.base.destroy(),this.destroyListeners(),this.destroySettings(),this.$shade.remove(),this.$container.remove(),this.trigger("destroy")}},{getInstance:function(){return this._instance||(this._instance=new Craft.SproutForms.ConditionalModal),this._instance}})}(jQuery)},function(t,e,i){function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}"undefined"===s(Craft.SproutForms)&&(Craft.SproutForms={}),Craft.SproutForms.EditableTable=Garnish.Base.extend({initialized:!1,id:null,baseName:null,columns:null,conditionalTypes:null,sorter:null,biggestId:-1,$table:null,$tbody:null,$addRowBtn:null,init:function(t,e,i,s,n){this.id=t,this.baseName=e,this.columns=i,this.conditionalTypes=n,this.setSettings(s,Craft.SproutForms.EditableTable.defaults),this.$table=$("#"+t),this.$tbody=this.$table.children("tbody"),this.sorter=new Craft.DataTableSorter(this.$table,{helperClass:"editabletablesorthelper",copyDraggeeInputValuesToHelper:!0}),this.isVisible()?this.initialize(this.conditionalTypes):this.addListener(Garnish.$win,"resize","initializeIfVisible")},isVisible:function(){return this.$table.height()>0},initialize:function(t){if(!this.initialized){this.initialized=!0,this.removeListener(Garnish.$win,"resize");for(var e=this.$tbody.children(),i=0;i<e.length;i++)new Craft.SproutForms.EditableTable.Row(this,e[i],t);this.$addRowBtn=this.$table.find(".buttons").children(".add"),this.addListener(this.$addRowBtn,"activate","addRow"),0==e.length&&this.addRow()}},initializeIfVisible:function(){this.isVisible()&&this.initialize()},addRow:function(){var t=this.settings.rowIdPrefix+(this.biggestId+1),e=Craft.SproutForms.EditableTable.getRowHtml(t,this.columns,this.baseName,{},this.conditionalTypes),i=$(e).appendTo(this.$tbody);new Craft.SproutForms.EditableTable.Row(this,i,this.conditionalTypes);i.find(".sprout-selectother");this.sorter.addItems(i),i.find("input,textarea,select").first().focus(),this.settings.onAddRow(i),this.$addRowBtn=i.find("#add-rule"),this.addListener(this.$addRowBtn,"activate","addRow")}},{textualColTypes:["singleline","multiline","number"],defaults:{rowIdPrefix:"",onAddRow:$.noop,onDeleteRow:$.noop},getRowHtml:function(t,e,i,s,n){var a='<tr data-id="'+t+'">',r="";for(var o in e){var d=e[o],l=i+"["+t+"]["+o+"]",c=void 0!==s[o]?s[o]:"",u=Craft.inArray(d.type,Craft.SproutForms.EditableTable.textualColTypes);switch(0==o&&(l,r=""!=c?c:d.options[0].value),a+='<td class="'+(u?"textual":"")+" "+(void 0!==d.class?d.class:"")+'"'+(void 0!==d.width?' width="'+d.width+'"':"")+">",d.type){case"select":a+='<div class="select"><select name="'+l+'">';var h=!1,f="selected";for(var p in d.options){var m=d.options[p];if(void 0!==m.optgroup)h?a+="</optgroup>":h=!0,a+='<optgroup label="'+m.optgroup+'">';else{var v=void 0!==m.label?m.label:m,b=void 0!==m.value?m.value:p;a+="<option "+f+' value="'+b+'"'+(b==c?" selected":"")+(void 0!==m.disabled&&m.disabled?" disabled":"")+">"+v+"</option>"}f=""}h&&(a+="</optgroup>"),a+="</select></div>";break;case"selectCondition":l;var $=void 0!==d.options[0]?d.options[0].value:"";""!=c?c:$,a+='<div class="select"><select data-check-value-html="true" name="'+l+'">',d.options=n[r].rulesAsOptions;var g=!1,y="selected";for(var C in d.options){var S=d.options[C];if(void 0!==S.optgroup)g?a+="</optgroup>":g=!0,a+='<optgroup label="'+S.optgroup+'">';else{var x=void 0!==S.label?S.label:S,T=void 0!==S.value?S.value:C;a+="<option "+y+' value="'+T+'"'+(T==c?" selected":"")+(void 0!==S.disabled&&S.disabled?" disabled":"")+">"+x+"</option>"}y=""}g&&(a+="</optgroup>"),a+="</select></div>";break;case"checkbox":a+='<input type="hidden" name="'+l+'"><input type="checkbox" name="'+l+'" value="1"'+(c?" checked":"")+">";break;default:a+='<input class="text fullwidth" type="text" name="'+l+'" value="'+c+'">'}a+="</td>"}return a+='<td class="thin action"><div class="buttons"> <div id="add-rule" class="btn add icon small" tabindex="0">OR</div> </div></td><td class="thin action"><a class="delete icon" title="'+Craft.t("sprout-seo","Delete")+'"></a></td></tr>'}}),Craft.SproutForms.EditableTable.Row=Garnish.Base.extend({table:null,id:null,niceTexts:null,$tr:null,$tds:null,$textareas:null,$deleteBtn:null,conditionalTypes:null,init:function(t,e,i){this.table=t,this.$tr=$(e),this.$tds=this.$tr.children(),this.conditionalTypes=i;var s=parseInt(this.$tr.attr("data-id").substr(this.table.settings.rowIdPrefix.length));s>this.table.biggestId&&(this.table.biggestId=s),this.$textareas=$(),this.niceTexts=[];var n={},a=this,r=0;for(var o in this.table.columns){var d=this.table.columns[o];if(Craft.inArray(d.type,Craft.SproutForms.EditableTable.textualColTypes)){var l=$("textarea",this.$tds[r]);this.$textareas=this.$textareas.add(l),this.addListener(l,"focus","onTextareaFocus"),this.addListener(l,"mousedown","ignoreNextTextareaFocus"),this.niceTexts.push(new Garnish.NiceText(l,{onHeightChange:$.proxy(this,"onTextareaHeightChange")})),"singleline"!==d.type&&"number"!==d.type||(this.addListener(l,"keypress",{type:d.type},"validateKeypress"),this.addListener(l,"textchange",{type:d.type},"validateValue")),n[o]=l}r++}for(var c in this.initSproutFields(),this.onTextareaHeightChange(),this.table.columns){var u=this.table.columns[c];u.autopopulate&&void 0!==n[u.autopopulate]&&!n[c].val()&&new Craft.HandleGenerator(n[c],n[u.autopopulate])}var h=this.$tr.find("td:eq(1)").find("select").data("check-value-html"),f=this.$tr.find("td:eq(0)").find("select"),p=this.$tr.find("td:eq(1)").find("select");f.change({row:this},(function(t){var e="";e+='<div class="select"><select data-check-value-html="true" name="'+name+'">';var i={};i.options=a.conditionalTypes[f.val()].rulesAsOptions;var s=p.val(),n=!1,r="selected";for(var o in i.options){var d=i.options[o];if(void 0!==d.optgroup)n?e+="</optgroup>":n=!0,e+='<optgroup label="'+d.optgroup+'">';else{var l=void 0!==d.label?d.label:d,c=void 0!==d.value?d.value:o;e+="<option "+r+' value="'+c+'"'+(c==s?" selected":"")+(void 0!==d.disabled&&d.disabled?" disabled":"")+">"+l+"</option>"}r=""}n&&(e+="</optgroup>"),e+="</select></div>",p.html(e),a.addValueInputHtml(a)})),p.change({row:this},(function(t){a.addValueInputHtml(a)})),p.change({row:this},(function(t){console.log(t.data.row.$tr.find("td:eq(0)").find("select").val())})),1==h&&this.addValueInputHtml();var m=this.$tr.children().last().find(".delete");this.addListener(m,"click","deleteRow")},addValueInputHtml:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=null==t?this:t,i=0===this.$tr.find("td:eq(2)").find("input").length?this.$tr.find("td:eq(2)").find("select"):this.$tr.find("td:eq(2)").find("input"),s={formFieldHandle:this.$tr.find("td:eq(0)").find("select").val(),condition:this.$tr.find("td:eq(1)").find("select").val(),inputName:i.attr("name"),inputValue:i.val(),formId:$("#formId").val()};Craft.postActionRequest("sprout-forms/conditionals/get-condition-input-html",s,$.proxy((function(t,i){"success"===i&&t.success?e.$tr.find("td:eq(2)").html(t.html):Craft.cp.displayError(Craft.t("sprout-forms","Unable to get the input html"))}),this))},initSproutFields:function(){Craft.SproutFields.initFields(this.$tr)},onTextareaFocus:function(t){this.onTextareaHeightChange();var e=$(t.currentTarget);e.data("ignoreNextFocus")?e.data("ignoreNextFocus",!1):setTimeout((function(){var t=e.val();if(void 0!==e[0].setSelectionRange){var i=2*t.length;e[0].setSelectionRange(0,i)}else e.val(t)}),0)},ignoreNextTextareaFocus:function(t){$.data(t.currentTarget,"ignoreNextFocus",!0)},validateKeypress:function(t){var e=t.keyCode?t.keyCode:t.charCode;Garnish.isCtrlKeyPressed(t)||e!==Garnish.RETURN_KEY&&("number"!==t.data.type||Craft.inArray(e,Craft.SproutForms.EditableTable.Row.numericKeyCodes))||t.preventDefault()},validateValue:function(t){var e;if("number"===t.data.type){var i=t.currentTarget.value.match(/^\s*(-?[\d\.]*)/);e=null!==i?i[1]:""}else e=t.currentTarget.value.replace(/[\r\n]/g,"");e!==t.currentTarget.value&&(t.currentTarget.value=e)},onTextareaHeightChange:function(){for(var t=-1,e=0;e<this.niceTexts.length;e++)this.niceTexts[e].height>t&&(t=this.niceTexts[e].height);this.$textareas.css("min-height",t);var i=this.$textareas.first().parent().height();i>t&&this.$textareas.css("min-height",i)},deleteRow:function(){this.table.sorter.removeItems(this.$tr),this.$tr.remove(),this.table.settings.onDeleteRow(this.$tr)}},{numericKeyCodes:[9,8,37,38,39,40,45,91,46,190,48,49,50,51,52,53,54,55,56,57]})},function(t,e,i){function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}"undefined"===s(Craft.SproutForms)&&(Craft.SproutForms={}),function(t){Craft.SproutForms.FieldLayoutEditor=Garnish.Base.extend({$container:null,$groupButton:null,$fieldButton:null,$settings:null,fld:null,modal:null,formLayout:null,fieldsLayout:null,wheelHtml:null,continueEditing:null,drake:null,drakeTabs:null,tabsLayout:null,$saveFormButton:null,init:function(e,i){var s=this;this.$saveFormButton=t("#save-form-button"),this.continueEditing=i,this.initButtons(),this.initTabSettings(),this.wheelHtml=' <span class="settings icon icon-wheel"></span>',this.modal=Craft.SproutForms.FieldModal.getInstance(),this.modal.on("newField",t.proxy((function(t){var e=t.field,i=e.group;this.addField(e.id,e.name,i.name)}),this)),this.modal.on("saveField",t.proxy((function(t){var e=t.field,i=e.group;this.resetField(e,i)}),this)),this.tabsLayout=this.getId("sprout-forms-tabs"),this.drakeTabs=dragula([this.tabsLayout],{accepts:function(e,i,s,n){return null===n||t(e).is(".drag-tab")},invalid:function(t,e){return t.classList.contains("donotdrag")}}).on("drag",(function(e){t(e).addClass("drag-tab-active")})).on("drop",(function(e,i,s){t(e).removeClass("drag-tab-active"),t(i).find(".drag-tab-active").removeClass("drag-tab-active"),t(s).find(".drag-tab-active").removeClass("drag-tab-active"),t(i).attr("id")===t(s).attr("id")&&t("#sprout-forms-tabs li.drag-tab a").each((function(e){var i=t(this).attr("id"),s=t("#sproutforms-fieldlayout-container");if(i){var n=t("#sproutforms-"+i);n&&s.append(n)}}))})),this.fieldsLayout=this.getId("right-copy"),this.drake=dragula([null,this.fieldsLayout],{copy:function(t,e){return e===s.fieldsLayout},accepts:function(t,e){return e!==s.fieldsLayout},invalid:function(t,e){return t.classList.contains("donotdrag")}}).on("drag",(function(e){t(e).addClass("drag-active")})).on("drop",(function(e,i,n){if(t(e).removeClass("drag-active"),t(i).find(".drag-active").removeClass("drag-active"),t(n).find(".drag-active").removeClass("drag-active"),t(i).attr("id"),t(n).attr("id"),i&&n===s.fieldsLayout){var a=t(e).closest(".sproutforms-tab-fields"),r=a.data("tabname"),o=a.data("tabid"),d=t(e).data("type");s.createDefaultField(d,o,r,e)}})).on("over",(function(e,i){t(e).addClass("drag-active"),t(i).addClass("container-active")})).on("out",(function(e,i){t(e).removeClass("drag-active"),t(i).removeClass("container-active")}));autoScroll([document.querySelector("#content-container")],{margin:20,maxSpeed:10,scrollWhenOutside:!0,autoScroll:function(){return this.down&&s.drake.dragging}}),autoScroll([document.querySelector("#sprout-forms-tabs")],{margin:20,maxSpeed:10,scrollWhenOutside:!0,autoScroll:function(){return this.down&&s.drakeTabs.dragging}});for(var n=0;n<e.length;n++)this.drake.containers.push(this.getId("sproutforms-tab-container-"+e[n].id))},clickHandler:function(t){var e=t.target;e!==this.tabsLayout&&(e.innerHTML+=" [click!]",setTimeout((function(){e.innerHTML=e.innerHTML.replace(/ \[click!]/g,"")}),500))},createDefaultField:function(e,i,s,n){t(n).removeClass("source-field"),t(n).addClass("target-field"),t(n).find(".source-field-header").remove(),t(n).find(".body").removeClass("hidden");var a=t(n).next(".target-field"),r=a.attr("id");if(null==r)a=null;else{var o=r.split("-");r=o[1]}var d=t(n).data("defaultname")?t(n).data("defaultname"):Craft.t("sprout-forms","Untitled");t(n).prepend(t(['<div class="active-field-header">',"<h2>",d,"</h2>","</div>"].join("")));var l={type:e,formId:t("#formId").val(),tabId:i,nextId:r};Craft.postActionRequest("sprout-forms/fields/create-field",l,t.proxy((function(t,e){"success"===e&&this.initFieldOnDrop(t.field,s,n)}),this))},initFieldOnDrop:function(e,i,s){null!==e&&e.hasOwnProperty("id")?(t(s).attr("id","sproutfield-"+e.id),t(s).prepend(t(['<ul class="settings">','<li><a id="sproutform-field-',e.id,'" data-fieldid="',e.id,'" href="#" tabindex="0" ><i class="fa fa-pencil fa-2x" title="',Craft.t("sprout-forms","Edit"),'"></i></a></li>',"</ul>"].join(""))),t(s).append(t(['<input type="hidden" name="fieldLayout[',i,'][]" value="',e.id,'" class="id-input">'].join(""))),this.addListener(t("#sproutform-field-"+e.id),"activate","editField")):(Craft.cp.displayError(Craft.t("sprout-forms","Something went wrong when creating the field :(")),t(s).remove())},getId:function(t){return document.getElementById(t)},initTabSettings:function(){var e=this;t("#sprout-forms-tabs li").each((function(i,s){var n=t(s).find("a").attr("id"),a=t(s).find(".settings");e.initializeWheel(a,n)}))},initializeWheel:function(e,i){var s=t('<div class="menu" data-align="center"/>').insertAfter(e),n=t("<ul/>").appendTo(s);t('<li><a data-action="add" data-tab-id="'+i+'">'+Craft.t("sprout-forms","Add Tab")+"</a></li>").appendTo(n),t('<li><a data-action="rename" data-tab-id="'+i+'">'+Craft.t("sprout-forms","Rename")+"</a></li>").appendTo(n),t('<li><a id ="#delete-'+i+'" data-action="delete" data-tab-id="'+i+'">'+Craft.t("sprout-forms","Delete")+"</a></li>").appendTo(n),new Garnish.MenuBtn(e,{onOptionSelect:t.proxy(this,"onTabOptionSelect")})},onTabOptionSelect:function(e){var i=t(e),s=i.data("tab-id");switch(i.data("action")){case"add":this.addNewTab();break;case"rename":this.renameTab(s);break;case"delete":this.deleteTab(s)}},initButtons:function(){var e=this;t("a[id^='sproutform-field-']").each((function(i,s){var n=t(s).data("fieldid");n&&e.addListener(t("#sproutform-field-"+n),"activate","editField")})),t("a[id^='delete-tab-']").each((function(i,s){var n=t(s).data("tabid");n&&e.addListener(t("#delete-tab-"+n),"activate","deleteTab")}))},deleteTab:function(e){if(this.confirmDeleteTab()){var i={tabId:e};Craft.postActionRequest("sprout-forms/fields/delete-tab",i,t.proxy((function(i,s){i.success?(Craft.cp.displayNotice(Craft.t("sprout-forms","Tab Deleted")),t("#sproutforms-"+e).slideUp(500,(function(){t(this).remove()})),t("#"+e).closest("li").slideUp(500,(function(){t(this).remove()}))):Craft.cp.displayError(Craft.t("sprout-forms","Unable to delete the tab"))}),this))}},renameTab:function(e){var i=t("#"+e+" .tab-label"),s=i.text().trim(),n=prompt(Craft.t("sprout-forms","Give your tab a name."),s),a=!0,r=t(".drag-tab"),o=t("#formId").val();if(n&&n!==s)if(r.each((function(e,i){if(t(i).find(".tab-label").text()===n)return a=!1,!1})),a&&n&&o){var d={name:n,oldName:s,formId:o};Craft.postActionRequest("sprout-forms/fields/rename-tab",d,t.proxy((function(a,r){a.success?(Craft.cp.displayNotice(Craft.t("sprout-forms","Tab renamed")),t("[name^='fieldLayout["+s+"]']").each((function(e,a){var r=t(a).attr("name").replace(s,n);t(a).attr("name",r),i.text(n)})),t("#sproutforms-"+e).attr("data-tabname",n)):Craft.cp.displayError(Craft.t("sprout-forms","Unable to rename tab"))}),this))}else Craft.cp.displayError(Craft.t("sprout-forms","Invalid tab name"))},addNewTab:function(){var e=this.promptForGroupName(""),i=!0,s=t(".drag-tab"),n=t("#formId").val(),a=this;if(s.each((function(s,n){var a=t(n).find(".tab-label").text();if(a&&a===e)return i=!1,!1})),i&&e&&n){var r={name:e,sortOrder:s.length,formId:n};Craft.postActionRequest("sprout-forms/fields/add-tab",r,t.proxy((function(e,i){if(e.success){var s=e.tab;Craft.cp.displayNotice(Craft.t("sprout-forms","Tab: "+s.name+" created"));var n="#sproutforms-tab-"+s.id;t("#sprout-forms-tabs").append('<li class="drag-tab"><a id="tab-'+s.id+'" class="tab" href="'+n+'" tabindex="0"><span class="tab-label">'+s.name+"</span>&nbsp;"+this.wheelHtml+"</a></li>");var r=t("#tab-"+s.id).find(".settings");a.initializeWheel(r,"tab-"+s.id),t("#sproutforms-fieldlayout-container").append(t(['<div id="sproutforms-tab-'+s.id+'" data-tabname="'+s.name+'" data-tabid="'+s.id+'" class="sproutforms-tab-fields hidden">','<div class="parent">','<div id="sproutforms-tab-container-'+s.id+'" class="sprout-tab-container">',"</div>","</div>","</div>"].join(""))),this.drake.containers.push(this.getId("sproutforms-tab-container-"+s.id)),Craft.cp.initTabs()}else Craft.cp.displayError(Craft.t("sprout-forms","Unable to create a new tab"))}),this))}else Craft.cp.displayError(Craft.t("sprout-forms","Invalid tab name"))},promptForGroupName:function(t){return prompt(Craft.t("sprout-forms","What do you want to name your new tab?"),t)},confirmDeleteTab:function(){return confirm("Are you sure you want to delete this tab, all of it's fields, and all of it's data?")},newField:function(){this.modal.show()},editField:function(e){var i=e.currentTarget,s=t(i).data("fieldid");this.$field=t(i),this.base(t(i)),this.modal.editField(s)},resetField:function(e,i){var s=t("#sproutfield-"+e.id);t(s).find(".body").html(e.htmlExample);var n=t(s).find("[name='requiredFields[]']");e.required?(t(s).find(".active-field-header h2").addClass("required"),n.length?t(n).val(e.id):t('<input type="hidden" name="requiredFields[]" value="'+e.id+'" class="sproutforms-required-input">').appendTo(s)):(t(s).find(".active-field-header h2").removeClass("required"),t(n).val("")),t(s).find(".active-field-header h2").html(e.name),t(s).find(".active-field-header p").html(e.instructions);var a=t(s).closest(".sproutforms-tab-fields"),r=a.data("tabname");a.data("tabid");if(r!==i.name){t(s).find(".id-input").remove();t(['<input class="id-input" type="hidden" name="fieldLayout[',i.name,'][]" value="',e.id,'">'].join("")).appendTo(t(s));var o=t("#sproutforms-tab-container-"+i.id);t(s).detach().appendTo(t(o))}}})}(jQuery)},function(t,e,i){function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}"undefined"===s(Craft.SproutForms)&&(Craft.SproutForms={}),function(t){var e=window.MutationObserver||window.WebKitMutationObserver;e||((e=function(){}).prototype.observe=function(){},e.prototype.disconnect=function(){}),Craft.SproutForms.FieldModal=Garnish.Modal.extend({$body:null,$content:null,$main:null,$footer:null,$leftButtons:null,$rightButtons:null,$saveBtn:null,$cancelBtn:null,$deleteBtn:null,$saveSpinner:null,$deleteSpinner:null,$loadSpinner:null,addedDelete:!1,$html:null,$js:null,$css:null,$currentHtml:null,$currentJs:null,$currentCss:null,$observed:null,observer:null,templateLoaded:!1,executedJs:null,loadedCss:null,init:function(i){this.base(),this.setSettings(i,{resizable:!0}),this.$currentHtml=t(),this.$currentJs=t(),this.$currentCss=t(),this.$observed=t(),this.executedJs={},this.loadedCss={},this.observer=new e(t.proxy((function(t){for(var e=0;e<t.length;e++)this.$observed=this.$observed.add(t[e].addedNodes)}),this));var s=t('<form class="modal sprout-field-modal" style="display: none; opacity: 0;">').appendTo(Garnish.$bod);this.$body=t('<div class="body">').appendTo(s),this.$content=t('<div class="content">').appendTo(this.$body),this.$main=t('<div class="main">').appendTo(this.$content),this.$footer=t('<div class="footer">').appendTo(s),this.$loadSpinner=t('<div class="spinner big">').appendTo(s),this.$leftButtons=t('<div class="buttons left">').appendTo(this.$footer),this.$rightButtons=t('<div class="buttons right">').appendTo(this.$footer),this.$deleteSpinner=t('<div class="spinner hidden">').appendTo(this.$leftButtons),this.$deleteBtn=t('<div class="btn delete hidden" role="button">').text(Craft.t("sprout-forms","Delete")).appendTo(this.$leftButtons),this.$cancelBtn=t('<div class="btn disabled" role="button">').text(Craft.t("sprout-forms","Cancel")).appendTo(this.$rightButtons),this.$saveBtn=t('<div class="btn submit disabled" role="button">').text(Craft.t("sprout-forms","Save")).appendTo(this.$rightButtons),this.$saveSpinner=t('<div class="spinner hidden">').appendTo(this.$rightButtons),this.setContainer(s);var n={formId:t("#formId").val()};Craft.postActionRequest("sprout-forms/fields/modal-field",n,t.proxy((function(t,e){"success"===e?(this.$loadSpinner.addClass("hidden"),this.initTemplate(t)):this.destroy()}),this))},initTemplate:function(e){var i=t.proxy((function(t){this.$html=t.$html,this.$js=t.$js,this.$css=t.$css,this.templateLoaded=!0,this.initListeners(),this.visible&&this.initSettings(),this.off("parseTemplate",i)}),this);this.on("parseTemplate",i),this.parseTemplate(e)},parseTemplate:function(e){var i=this,s=Garnish.$doc.find("head"),n=t(e.html),a=t(e.js).filter("script"),r=t(e.css).filter("style, link"),o=r.filter("link").prop("async",!0),d=r.filter("style");o.each((function(){var e=t(this),n=e.prop("href");i.loadedCss.hasOwnProperty(n)||(s.append(e),i.loadedCss[n]=e)}));var l=a.filter("[src]"),c=a.filter(":not([src])"),u=[];l.each((function(){var e=t(this).prop("src");i.executedJs.hasOwnProperty(e)||(u.push(e),i.executedJs[e]=!0)}));t.when(this.runExternalScripts(u)).then(function t(){i.off("runExternalScripts",t),i.trigger("parseTemplate",{target:this,$html:n,$js:c,$css:d})}()),this.$deleteBtn.removeClass("hidden"),this.$saveBtn.removeClass("disabled"),this.$cancelBtn.removeClass("disabled")},runExternalScripts:function(e){var i=e.length;if(i>0)for(var s=0;s<e.length;s++){var n=e[s];(n.indexOf("MatrixConfigurator")>=0||n.indexOf("TableFieldSettings.min.js")>=0||n.indexOf("quill.min.js")>=0||n.indexOf("sproutfields.js")>=0||n.indexOf("EditableTable.js")>=0||n.indexOf("initialize.js")>=0)&&t.getScript(n,t.proxy((function(t,e){"success"===e?0===--i&&this.trigger("runExternalScripts",{target:this}):Craft.cp.displayError(Craft.t("sprout-forms","Could not load all resources."))}),this))}else this.trigger("runExternalScripts",{target:this})},initListeners:function(){this.$deleteBtn.addClass("hidden"),this.$cancelBtn.addClass("disabled"),this.$saveBtn.addClass("disabled"),this.addListener(this.$cancelBtn,"activate","closeModal"),this.addListener(this.$saveBtn,"activate","saveField"),this.addedDelete||(this.addListener(this.$deleteBtn,"click","deleteField"),this.addedDelete=!0),this.on("show",this.initSettings),this.on("fadeOut",this.destroySettings),this.enable()},destroyListeners:function(){this.$cancelBtn.addClass("disabled"),this.$saveBtn.addClass("disabled"),this.removeListener(this.$cancelBtn,"activate"),this.removeListener(this.$saveBtn,"activate"),this.off("show",this.initSettings),this.off("fadeOut",this.destroySettings),this.disable()},initSettings:function(e){var i=e&&e.target?e.target:this;if(i.templateLoaded){i.$currentHtml=e&&e.$html?e.$html:i.$html.clone(),i.$currentJs=e&&e.$js?e.$js:i.$js.clone(),i.$currentCss=e&&e.$css?e.$css:i.$css.clone(),i.$observed=t(),i.observer.observe(Garnish.$bod[0],{childList:!0,subtree:!1}),i.$main.append(i.$currentHtml),Garnish.$bod.append(i.$currentJs);i.$main.find('input[name="fieldId"]');Craft.initUiElements();t.when(i.runExternalScripts(Object.keys(i.executedJs))).then(function t(){i.off("runExternalScripts",t),setTimeout((function(){i.observer.disconnect()}),1)}())}},destroySettings:function(t){var e=t&&t.target?t.target:this;e.$currentHtml.remove(),e.$currentJs.remove(),e.$currentCss.remove(),e.$observed.remove()},closeModal:function(){this.hide()},saveField:function(e){if(e&&e.preventDefault(),!this.$saveBtn.hasClass("disabled")&&this.$saveSpinner.hasClass("hidden")){this.destroyListeners(),this.$saveSpinner.removeClass("hidden");var i=this.$container.serialize(),s=this.$container.find('input[name="fieldId"]'),n=!!s.length&&s.val();Craft.postActionRequest("sprout-forms/fields/save-field",i,t.proxy((function(e,i){this.$saveSpinner.addClass("hidden");var s="success"===i;if(s&&e.success)this.initListeners(),!1===n?this.trigger("newField",{target:this,field:e.field}):(this.trigger("saveField",{target:this,field:e.field}),Craft.cp.displayNotice(Craft.t("sprout-forms","'{name}' field saved.",{name:e.field.name}))),this.hide();else if(s&&e.template)if(this.visible){var a=t.proxy((function(t){this.initListeners(),this.destroySettings(),this.initSettings(t),this.off("parseTemplate",a)}),this);this.on("parseTemplate",a),this.parseTemplate(e.template),Garnish.shake(this.$container)}else this.initListeners();else this.initListeners(),Craft.cp.displayError(Craft.t("sprout-forms","An unknown error occurred."))}),this))}},editField:function(e){this.destroyListeners(),this.show(),this.initListeners(),this.$loadSpinner.removeClass("hidden");var i={fieldId:e,formId:t("#formId").val()};Craft.postActionRequest("sprout-forms/fields/edit-field",i,t.proxy((function(e,i){this.$loadSpinner.addClass("hidden");var s="success"===i;if(s&&e.success){var n=t.proxy((function(t){this.destroySettings(),this.initSettings(t),this.off("parseTemplate",n)}),this);this.on("parseTemplate",n),this.parseTemplate(e.template)}else s&&e.error?(Craft.cp.displayError(e.error),this.hide()):(Craft.cp.displayError(Craft.t("sprout-forms","An unknown error occurred. ")),this.hide())}),this))},deleteField:function(e){if(e.preventDefault(),this.confirmDeleteField()){this.destroyListeners();var i=this.$container.serialize(),s=t(this.$container).find('input[name="fieldId"]').val();Craft.postActionRequest("sprout-forms/fields/delete-field",i,t.proxy((function(e,i){"success"===i&&e.success?(Craft.cp.displayNotice(Craft.t("sprout-forms","Field deleted.")),t("#sproutfield-"+s).remove(),this.initListeners(),this.hide()):(Craft.cp.displayError(Craft.t("sprout-forms","Unable to delete field.")),this.hide())}),this))}},confirmDeleteField:function(){return confirm("Are you sure you want to delete this field and all of it's data?")},hide:function(){this._disabled||this.base()},destroy:function(){this.base.destroy(),this.destroyListeners(),this.destroySettings(),this.$shade.remove(),this.$container.remove(),this.trigger("destroy")}},{getInstance:function(){return this._instance||(this._instance=new Craft.SproutForms.FieldModal),this._instance}})}(jQuery)},function(t,e,i){function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}"undefined"===s(Craft.SproutForms)&&(Craft.SproutForms={}),function(t){Craft.SproutForms.FormSettings=Garnish.Base.extend({options:null,modal:null,conditionalModal:null,$lightswitches:null,init:function(){this.initButtons()},initButtons:function(){var e=this;t("a[id^='sproutform-integration']").each((function(i,s){var n=t(s).data("integrationid");n&&e.addListener(t("#sproutform-integration-"+n),"activate","editIntegration")})),t("a[id^='sproutform-conditional']").each((function(i,s){var n=t(s).data("conditionalid");n&&e.addListener(t("#sproutform-conditional-"+n),"activate","editConditional")})),this.$lightswitches=t(".sproutforms-integration-row .lightswitch"),this.addListener(this.$lightswitches,"click","onChange"),this.modal=Craft.SproutForms.IntegrationModal.getInstance(),this.modal.on("saveIntegration",t.proxy((function(t){var e=t.integration;this.resetIntegration(e)}),this)),this.conditionalModal=Craft.SproutForms.ConditionalModal.getInstance(),this.conditionalModal.on("saveConditional",t.proxy((function(t){var e=t.conditional;this.resetConditional(e)}),this)),this.addListener(t("#integrationsOptions"),"change","createDefaultIntegration"),this.addListener(t("#conditionalOptions"),"change","createDefaultConditional")},onChange:function(e){var i=e.currentTarget,s=i.id,n=t(i).attr("aria-checked"),a={integrationId:s,enabled:n="true"===n?1:0,formId:t("#formId").val()};Craft.postActionRequest("sprout-forms/integrations/enable-integration",a,t.proxy((function(t,e){"success"===e&&t.success?Craft.cp.displayNotice(Craft.t("sprout-forms","Integration updated.")):Craft.cp.displayError(Craft.t("sprout-forms","Unable to update integration"))}),this))},resetIntegration:function(e){var i=t("#sproutform-integration-"+e.id),s=t("#integration-enabled-"+e.id),n="1"===e.enabled;n!==("true"===s.attr("aria-checked"))&&(s.attr("aria-checked",""+n),n?s.addClass("on"):s.removeClass("on")),i.html(e.name)},resetConditional:function(e){var i=t("#sproutform-conditional-"+e.id),s=t("#conditional-enabled-"+e.id),n="1"===e.enabled;n!==("true"===s.attr("aria-checked"))&&(s.attr("aria-checked",""+n),n?s.addClass("on"):s.removeClass("on")),i.html(e.name)},createDefaultIntegration:function(e){var i=this,s=t("#sproutforms-integrations-table tbody"),n=t("#integrationsOptions").val(),a=t("#formId").val();if(""!==n){var r={type:n,formId:a,sendRule:"*"};Craft.postActionRequest("sprout-forms/integrations/save-integration",r,t.proxy((function(e,n){if("success"===n){var a=e.integration;s.append('<tr class="field sproutforms-integration-row" id ="sproutforms-integration-row-'+a.id+'"><td class="heading"><a href="#" id ="sproutform-integration-'+a.id+'" data-integrationid="'+a.id+'">'+a.name+'</a></td><td><div class="lightswitch small" tabindex="0" data-value="1" role="checkbox" aria-checked="false" id ="integration-enabled-'+a.id+'"><div class="lightswitch-container"><div class="label on"></div><div class="handle"></div><div class="label off"></div></div><input type="hidden" name="" value=""></div></td></tr>'),i.addListener(t("#sproutform-integration-"+a.id),"activate","editIntegration"),t("#integrationsOptions").val("");var r=t("#integration-enabled-"+a.id);r.lightswitch(),i.addListener(r,"click","onChange")}}),this))}},createDefaultConditional:function(e){var i=this,s=t("#sproutforms-conditionalrules-table tbody"),n=t("#conditionalOptions").val(),a=t("#formId").val();if(""!==n){var r={type:n,formId:a};Craft.postActionRequest("sprout-forms/conditionals/save-conditional",r,t.proxy((function(e,n){if("success"===n){var a=e.conditional;s.append('<tr id ="sproutforms-conditional-row-'+a.id+'" class="field sproutforms-conditional-row"><td><a href="#" id ="sproutform-conditional-'+a.id+'" data-conditionalid="'+a.id+'">'+a.name+'</a></td><td><div class="lightswitch small" tabindex="0" data-value="1" role="checkbox" aria-checked="false" id ="conditional-enabled-'+a.id+'"><div class="lightswitch-container"><div class="label on"></div><div class="handle"></div><div class="label off"></div></div><input type="hidden" name="" value=""></div></td></tr>'),i.addListener(t("#sproutform-conditional-"+a.id),"activate","editConditional"),t("#conditionalOptions").val("");var r=t("#conditional-enabled-"+a.id);r.lightswitch(),i.addListener(r,"click","onChange")}}),this))}},editConditional:function(e){var i=e.currentTarget,s=t(i).data("conditionalid");console.log(s),this.base(t(i)),this.conditionalModal.editConditional(s)},editIntegration:function(e){var i=e.currentTarget,s=t(i).data("integrationid");this.base(t(i)),this.modal.editIntegration(s)}})}(jQuery)},function(t,e,i){function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}"undefined"===s(Craft.SproutForms)&&(Craft.SproutForms={}),function(t){var e=window.MutationObserver||window.WebKitMutationObserver;e||((e=function(){}).prototype.observe=function(){},e.prototype.disconnect=function(){}),Craft.SproutForms.IntegrationModal=Garnish.Modal.extend({$body:null,$content:null,$main:null,$footer:null,$leftButtons:null,$rightButtons:null,$saveBtn:null,$cancelBtn:null,$deleteBtn:null,$saveSpinner:null,$deleteSpinner:null,$loadSpinner:null,addedDelete:!1,$html:null,$js:null,$css:null,$currentHtml:null,$currentJs:null,$currentCss:null,$observed:null,observer:null,templateLoaded:!1,executedJs:null,loadedCss:null,init:function(i){this.base(),this.setSettings(i,{resizable:!0}),this.$currentHtml=t(),this.$currentJs=t(),this.$currentCss=t(),this.$observed=t(),this.executedJs={},this.loadedCss={},this.observer=new e(t.proxy((function(t){for(var e=0;e<t.length;e++)this.$observed=this.$observed.add(t[e].addedNodes)}),this));var s=t('<form class="modal sprout-field-modal" style="display: none; opacity: 0;">').appendTo(Garnish.$bod);this.$body=t('<div class="body">').appendTo(s),this.$content=t('<div class="content">').appendTo(this.$body),this.$main=t('<div class="main">').appendTo(this.$content),this.$footer=t('<div class="footer">').appendTo(s),this.$loadSpinner=t('<div class="spinner big">').appendTo(s),this.$leftButtons=t('<div class="buttons left">').appendTo(this.$footer),this.$rightButtons=t('<div class="buttons right">').appendTo(this.$footer),this.$deleteSpinner=t('<div class="spinner hidden">').appendTo(this.$leftButtons),this.$deleteBtn=t('<div class="btn delete hidden" role="button">').text(Craft.t("sprout-forms","Delete")).appendTo(this.$leftButtons),this.$cancelBtn=t('<div class="btn disabled" role="button">').text(Craft.t("sprout-forms","Cancel")).appendTo(this.$rightButtons),this.$saveBtn=t('<div class="btn submit disabled" role="button">').text(Craft.t("sprout-forms","Save")).appendTo(this.$rightButtons),this.$saveSpinner=t('<div class="spinner hidden">').appendTo(this.$rightButtons),this.setContainer(s),this.$loadSpinner.addClass("hidden");this.initTemplate({html:"",js:"",css:""})},initTemplate:function(e){var i=t.proxy((function(t){this.$html=t.$html,this.$js=t.$js,this.$css=t.$css,this.templateLoaded=!0,this.initListeners(),this.visible&&this.initSettings(),this.off("parseTemplate",i)}),this);this.on("parseTemplate",i),this.parseTemplate(e)},parseTemplate:function(e){var i=this,s=Garnish.$doc.find("head"),n=t(e.html),a=t(e.js).filter("script"),r=t(e.css).filter("style, link"),o=r.filter("link").prop("async",!0),d=r.filter("style");o.each((function(){var e=t(this),n=e.prop("href");i.loadedCss.hasOwnProperty(n)||(s.append(e),i.loadedCss[n]=e)}));var l=a.filter("[src]"),c=a.filter(":not([src])"),u=[];l.each((function(){var e=t(this).prop("src");i.executedJs.hasOwnProperty(e)||(u.push(e),i.executedJs[e]=!0)}));t.when(this.runExternalScripts(u)).then(function t(){i.off("runExternalScripts",t),i.trigger("parseTemplate",{target:this,$html:n,$js:c,$css:d})}()),this.$deleteBtn.removeClass("hidden"),this.$saveBtn.removeClass("disabled"),this.$cancelBtn.removeClass("disabled")},runExternalScripts:function(e){var i=e.length;if(i>0)for(var s=0;s<e.length;s++){var n=e[s];(n.indexOf("MatrixConfigurator")>=0||n.indexOf("TableFieldSettings.min.js")>=0||n.indexOf("quill.min.js")>=0||n.indexOf("sproutfields.js")>=0||n.indexOf("EditableTable.js")>=0||n.indexOf("initialize.js")>=0)&&t.getScript(n,t.proxy((function(t,e){"success"===e?0===--i&&this.trigger("runExternalScripts",{target:this}):Craft.cp.displayError(Craft.t("sprout-forms","Could not load all resources."))}),this))}else this.trigger("runExternalScripts",{target:this})},initListeners:function(){this.$deleteBtn.addClass("hidden"),this.$cancelBtn.addClass("disabled"),this.$saveBtn.addClass("disabled"),this.addListener(this.$cancelBtn,"activate","closeModal"),this.addListener(this.$saveBtn,"activate","saveIntegration"),this.addedDelete||(this.addListener(this.$deleteBtn,"click","deleteIntegration"),this.addedDelete=!0),this.on("show",this.initSettings),this.on("fadeOut",this.destroySettings),this.enable()},destroyListeners:function(){this.$cancelBtn.addClass("disabled"),this.$saveBtn.addClass("disabled"),this.removeListener(this.$cancelBtn,"activate"),this.removeListener(this.$saveBtn,"activate"),this.off("show",this.initSettings),this.off("fadeOut",this.destroySettings),this.disable()},initSettings:function(e){var i=e&&e.target?e.target:this;if(i.templateLoaded){i.$currentHtml=e&&e.$html?e.$html:i.$html.clone(),i.$currentJs=e&&e.$js?e.$js:i.$js.clone(),i.$currentCss=e&&e.$css?e.$css:i.$css.clone(),i.$observed=t(),i.observer.observe(Garnish.$bod[0],{childList:!0,subtree:!1}),i.$main.append(i.$currentHtml),Garnish.$bod.append(i.$currentJs),Craft.initUiElements();t.when(i.runExternalScripts(Object.keys(i.executedJs))).then(function t(){i.off("runExternalScripts",t),setTimeout((function(){i.observer.disconnect()}),1)}())}},destroySettings:function(t){var e=t&&t.target?t.target:this;e.$currentHtml.remove(),e.$currentJs.remove(),e.$currentCss.remove(),e.$observed.remove()},closeModal:function(){this.hide()},saveIntegration:function(e){if(e&&e.preventDefault(),!this.$saveBtn.hasClass("disabled")&&this.$saveSpinner.hasClass("hidden")){this.destroyListeners(),this.$saveSpinner.removeClass("hidden");var i=this.$container.serialize(),s=this.$container.find('input[name="integrationId"]');!!s.length&&s.val();Craft.postActionRequest("sprout-forms/integrations/save-integration",i,t.proxy((function(e,i){this.$saveSpinner.addClass("hidden");var s="success"===i;if(s&&e.success)this.initListeners(),this.trigger("saveIntegration",{target:this,integration:e.integration}),Craft.cp.displayNotice(Craft.t("sprout-forms","'{name}' integration saved.",{name:e.integration.name})),this.hide();else if(s&&e.template)if(this.visible){var n=t.proxy((function(t){this.initListeners(),this.destroySettings(),this.initSettings(t),this.off("parseTemplate",n)}),this);this.on("parseTemplate",n),this.parseTemplate(e.template),Garnish.shake(this.$container)}else this.initListeners();else this.initListeners(),Craft.cp.displayError(Craft.t("sprout-forms","An unknown error occurred."))}),this))}},editIntegration:function(e){this.destroyListeners(),this.show(),this.initListeners(),this.$loadSpinner.removeClass("hidden");var i={integrationId:e,formId:t("#formId").val()};Craft.postActionRequest("sprout-forms/integrations/edit-integration",i,t.proxy((function(e,i){this.$loadSpinner.addClass("hidden");var s="success"===i;if(s&&e.success){var n=t.proxy((function(t){this.destroySettings(),this.initSettings(t),this.off("parseTemplate",n)}),this);this.on("parseTemplate",n),this.parseTemplate(e.template)}else s&&e.error?(Craft.cp.displayError(e.error),this.hide()):(Craft.cp.displayError(Craft.t("sprout-forms","An unknown error occurred. ")),this.hide())}),this))},deleteIntegration:function(e){if(e.preventDefault(),this.confirmDeleteIntegration()){this.destroyListeners();var i=this.$container.serialize(),s=t(this.$container).find('input[name="integrationId"]').val();Craft.postActionRequest("sprout-forms/integrations/delete-integration",i,t.proxy((function(e,i){"success"===i&&e.success?(Craft.cp.displayNotice(Craft.t("sprout-forms","Integration deleted.")),t("#sproutforms-integration-row-"+s).remove(),this.initListeners(),this.hide()):(Craft.cp.displayError(Craft.t("sprout-forms","Unable to delete integration.")),this.hide())}),this))}},confirmDeleteIntegration:function(){return confirm("Are you sure you want to delete this integration and all of it's settings?")},hide:function(){this._disabled||this.base()},destroy:function(){this.base.destroy(),this.destroyListeners(),this.destroySettings(),this.$shade.remove(),this.$container.remove(),this.trigger("destroy")}},{getInstance:function(){return this._instance||(this._instance=new Craft.SproutForms.IntegrationModal),this._instance}})}(jQuery)}]);