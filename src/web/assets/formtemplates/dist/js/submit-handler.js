/*! For license information please see submit-handler.js.LICENSE */
!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=43)}({43:function(e,t,r){e.exports=r(44)},44:function(e,t){function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,o=!1,s=void 0;try{for(var i,l=e[Symbol.iterator]();!(n=(i=l.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,s=e}finally{try{n||null==l.return||l.return()}finally{if(o)throw s}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function n(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=function(){function e(t){var r,n,s,i,l,a,u,m,c,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o(this,e),this.formId=t,this.form=document.getElementById(this.formId),this.submitButtons=this.form.querySelectorAll('[type="submit"]'),this.messageBoxId=this.formId+"-message-box",this.async=null!==(r=f.async)&&void 0!==r&&r,this.globalErrorsEnabled=null!==(n=f.globalErrorsEnabled)&&void 0!==n&&n,this.inlineErrorsEnabled=null===(s=f.inlineErrorsEnabled)||void 0===s||s,this.successMessageClass=null!==(i=f.successMessageClass)&&void 0!==i?i:"sproutforms-message-success",this.errorMessageClass=null!==(l=f.errorMessageClass)&&void 0!==l?l:"sproutforms-message-errors",this.failureMessage=null!==(a=f.failureMessage)&&void 0!==a?a:"Submission failed",this.messageElement=null!==(u=f.messageElement)&&void 0!==u?u:"div",this.errorsContainerElement=null!==(m=f.errorsContainerElement)&&void 0!==m?m:"ul.errors",this.errorsItemElement=null!==(c=f.errorsItemElement)&&void 0!==c?c:"li",this.addFormSubmitEventListener()}var t,i,l;return t=e,(i=[{key:"addFormSubmitEventListener",value:function(){var e=this;e.form.addEventListener("submit",(function(t){t.target&&(t.preventDefault(),e.handleBeforeFormSubmit())}),!1)}},{key:"handleBeforeFormSubmit",value:function(){var e=this;this.getBeforeFormSubmitPromise().then(e.onFormSubmitEvent.bind(e)).then((function(){e.handleFormSubmit()})).catch(e.onFormSubmitCancelledEvent.bind(e))}},{key:"handleFormSubmit",value:function(){this.getFormSubmitPromise().then(this.onAfterFormSubmitEvent.bind(this)).catch(this.onFormSubmitCancelledEvent.bind(this))}},{key:"getBeforeFormSubmitPromise",value:function(){console.log("getBeforeFormSubmitPromise");var e=this,t=new CustomEvent("beforeSproutFormsSubmit",{detail:{promises:[]},bubbles:!0,cancelable:!0});return new Promise((function(r,n){if(!e.form.dispatchEvent(t))return n(!1);var o=t.detail.promises;return Promise.all(o).then((function(e){var t=!0,r=!1,o=void 0;try{for(var s,i=e[Symbol.iterator]();!(t=(s=i.next()).done);t=!0)if(!1===s.value)return n(!1)}catch(e){r=!0,o=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw o}}})).catch((function(){return n(!1)})),r(!0)}))}},{key:"onFormSubmitEvent",value:function(){var e=this,t=new CustomEvent("sproutFormsSubmit",{detail:{submitHandler:e},bubbles:!0,cancelable:!0});return new Promise((function(r,n){return e.form.dispatchEvent(t)?r(!0):n(!1)}))}},{key:"getFormSubmitPromise",value:function(){var e=this;return new Promise((function(t){e.async?e.submitAsync():e.form.submit(),t(!0)}))}},{key:"onAfterFormSubmitEvent",value:function(){var e=new CustomEvent("afterSproutFormsSubmit",{bubbles:!0});this.form.dispatchEvent(e)}},{key:"onFormSubmitCancelledEvent",value:function(){var e=new CustomEvent("onSproutFormSubmitCancelled",{bubbles:!0});this.form.dispatchEvent(e)}},{key:"submitAsync",value:function(){var e=this,t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===t.readyState){var o=JSON.parse(t.responseText);if(t.status>=200||t.status<300){e.removeInlineErrors();var s=document.getElementById(e.messageBoxId);if(null!==s&&s.parentNode.removeChild(s),o.success)e.displayMessageBox({id:e.messageBoxId,message:o.message,messageClass:e.successMessageClass});else{var i=!(!o||!o.errorDisplayMethod)&&["global","both"].indexOf(o.errorDisplayMethod)>=0,l=!(!o||!o.errorDisplayMethod)&&["inline","both"].indexOf(o.errorDisplayMethod)>=0,a=[];if(i)for(var u=0,m=Object.entries(o.errors);u<m.length;u++){var c=m[u];void 0!==c[1]&&(a=[].concat(n(a),n(c[1])))}var f,d=e.getErrorList(a);if((o.message||d)&&e.displayMessageBox({id:e.messageBoxId,message:null!==(f=o.message)&&void 0!==f?f:null,messageClass:e.errorMessageClass,errors:d}),l)for(var v=0,h=Object.entries(o.errors);v<h.length;v++){var b=r(h[v],2),g=b[0],y=b[1],p=document.getElementById("fields-"+g+"-field"),E="."+e.getTargetElementClasses(e.errorsContainerElement).join("."),S=p.querySelector(E);S&&S.parentNode.removeChild(S),p.append(e.getErrorList(y))}}}else{var C={};"string"==typeof o.error&&(C=e.getErrorList([o.error])),e.displayMessageBox({id:e.messageBoxId,message:"<p>"+e.failureMessage+"</p>",messageClass:e.errorMessageClass,errors:C})}}};var o=new FormData(e.form);t.open("POST","/"),t.setRequestHeader("Accept","application/json"),t.send(o)}},{key:"displayMessageBox",value:function(e){var t,r,n,o,s=null!==(t=e.id)&&void 0!==t?t:null,i=null!==(r=e.message)&&void 0!==r?r:null,l=null!==(n=e.messageClass)&&void 0!==n?n:"",a=null!==(o=e.errors)&&void 0!==o?o:null,u=this.getElementWithClasses(this.messageElement);s&&u.setAttribute("id",s),u.classList.add(l),u.innerHTML=i,a&&u.append(a);var m=document.getElementById(this.messageBoxId);m?m.parentNode.replaceChild(u,m):this.form.prepend(u)}},{key:"removeInlineErrors",value:function(){var e=this.getTargetElementClasses(this.errorsContainerElement).map((function(e){return"."+e})),t=document.querySelectorAll(".field"),r=!0,n=!1,o=void 0;try{for(var s,i=t[Symbol.iterator]();!(r=(s=i.next()).done);r=!0){var l=s.value.querySelector(e);null!==l&&l.parentNode.removeChild(l)}}catch(e){n=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(n)throw o}}}},{key:"getErrorList",value:function(e){var t=this.getElementWithClasses(this.errorsContainerElement),r=!0,n=!1,o=void 0;try{for(var s,i=e[Symbol.iterator]();!(r=(s=i.next()).done);r=!0){var l=s.value,a=this.getElementWithClasses(this.errorsItemElement);a.innerHTML=l,t.appendChild(a)}}catch(e){n=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(n)throw o}}return t}},{key:"getElementWithClasses",value:function(e){if("string"!=typeof e)return null;var t=this.getTargetElementName(e),r=this.getTargetElementClasses(e);if(!t)return null;var n=document.createElement(t);if(null!==r&&r.length){var o=!0,s=!1,i=void 0;try{for(var l,a=r[Symbol.iterator]();!(o=(l=a.next()).done);o=!0){var u=l.value;n.classList.add(u)}}catch(e){s=!0,i=e}finally{try{o||null==a.return||a.return()}finally{if(s)throw i}}}return n}},{key:"getTargetElementName",value:function(e){var t=e.split(".");return t.length>0?t[0]:null}},{key:"getTargetElementClasses",value:function(e){var t=e.split(".");return t.length>1?t.slice(1,t.length):null}}])&&s(t.prototype,i),l&&s(t,l),e}();window.SproutFormsSubmitHandler=i}});