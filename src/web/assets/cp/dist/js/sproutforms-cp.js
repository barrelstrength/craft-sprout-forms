/*! For license information please see sproutforms-cp.js.LICENSE */
!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=2)}([function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";function i(t,e){return void 0===t?void 0===e?t:e:t}Object.defineProperty(e,"__esModule",{value:!0}),e.boolean=function(t,e){return"function"==typeof(t=i(t,e))?function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];return!!t.apply(this,n)}:t?function(){return!0}:function(){return!1}},e.integer=function(t,e){return"function"==typeof(t=i(t,e))?function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=parseInt(t.apply(this,n),10);return r!=r?0:r}:(t=parseInt(t,10))!=t?function(){return 0}:function(){return t}},e.string=function(t,e){return"function"==typeof(t=i(t,e))?function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];return""+t.apply(this,n)}:(t=""+t,function(){return t})}},function(t,e,n){n(3),n(4),n(5),n(28),n(29),n(30),n(31),n(43),n(48),t.exports=n(51)},function(t,e,n){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}"undefined"===i(Craft.SproutForms)&&(Craft.SproutForms={}),Craft.SproutForms.EditableTable=Garnish.Base.extend({initialized:!1,id:null,baseName:null,columns:null,fieldRuleOptions:null,sorter:null,biggestId:-1,$table:null,$tbody:null,$addRowBtn:null,init:function(t,e,n,i,r){this.id=t,this.baseName=e,this.columns=n,this.fieldRuleOptions=r,this.setSettings(i,Craft.SproutForms.EditableTable.defaults),this.$table=$("#"+t),this.$tbody=this.$table.children("tbody"),this.sorter=new Craft.DataTableSorter(this.$table,{helperClass:"editabletablesorthelper",copyDraggeeInputValuesToHelper:!0}),this.isVisible()?this.initialize(this.fieldRuleOptions):this.addListener(Garnish.$win,"resize","initializeIfVisible")},isVisible:function(){return this.$table.height()>0},initialize:function(t){if(!this.initialized){this.initialized=!0,this.removeListener(Garnish.$win,"resize");for(var e=this.$tbody.children(),n=0;n<e.length;n++)new Craft.SproutForms.EditableTable.Row(this,e[n],t);this.$addRowBtn=this.$table.find(".buttons").children(".add"),this.addListener(this.$addRowBtn,"activate","addRow"),0===e.length&&this.addRow()}},initializeIfVisible:function(){this.isVisible()&&this.initialize()},addRow:function(){var t=this.settings.rowIdPrefix+(this.biggestId+1),e=Craft.SproutForms.EditableTable.getRowHtml(t,this.columns,this.baseName,{},this.fieldRuleOptions),n=$(e).appendTo(this.$tbody);new Craft.SproutForms.EditableTable.Row(this,n,this.fieldRuleOptions);n.find(".sprout-selectother");this.sorter.addItems(n),n.find("input,textarea,select").first().focus(),this.settings.onAddRow(n),this.$addRowBtn=n.find("#add-rule"),this.addListener(this.$addRowBtn,"activate","addRow")}},{textualColTypes:["singleline","multiline","number"],defaults:{rowIdPrefix:"",onAddRow:$.noop,onDeleteRow:$.noop},getRowHtml:function(t,e,n,i,r){var o='<tr data-id="'+t+'">',s="";for(var a in e){var l=e[a],d=n+"[condition-"+t+"]["+a+"]",u=void 0!==i[a]?i[a]:"",c=Craft.inArray(l.type,Craft.SproutForms.EditableTable.textualColTypes);switch("0"===a&&(d,s=""!==u?u:l.options[0].value),o+='<td class="'+(c?"textual":"")+" "+(void 0!==l.class?l.class:"")+'"'+(void 0!==l.width?' width="'+l.width+'"':"")+">",l.type){case"select":o+='<div class="select"><select name="'+d+'">';var f=!1,h="selected";for(var p in l.options){var m=l.options[p];if(void 0!==m.optgroup)f?o+="</optgroup>":f=!0,o+='<optgroup label="'+m.optgroup+'">';else{var v=void 0!==m.label?m.label:m,g=void 0!==m.value?m.value:p;o+="<option "+h+' value="'+g+'"'+(g===u?" selected":"")+(void 0!==m.disabled&&m.disabled?" disabled":"")+">"+v+"</option>"}h=""}f&&(o+="</optgroup>"),o+="</select></div>";break;case"selectCondition":d;var b=void 0!==l.options[0]?l.options[0].value:"";""!==u?u:b,o+='<div class="select"><select data-check-value-html="true" name="'+d+'">',l.options=r[s].conditionsAsOptions;var y=!1,$="selected";for(var w in l.options){var C=l.options[w];if(void 0!==C.optgroup)y?o+="</optgroup>":y=!0,o+='<optgroup label="'+C.optgroup+'">';else{var T=void 0!==C.label?C.label:C,S=void 0!==C.value?C.value:w;o+="<option "+$+' value="'+S+'"'+(S===u?" selected":"")+(void 0!==C.disabled&&C.disabled?" disabled":"")+">"+T+"</option>"}$=""}y&&(o+="</optgroup>"),o+="</select></div>";break;case"checkbox":o+='<input type="hidden" name="'+d+'"><input type="checkbox" name="'+d+'" value="1"'+(u?" checked":"")+">";break;default:o+='<input class="text fullwidth" type="text" name="'+d+'" value="'+u+'">'}o+="</td>"}return o+='<td class="thin action"><div class="buttons"> <div id="add-rule" class="btn add icon small" tabindex="0">OR</div> </div></td><td class="thin action"><a class="delete icon" title="'+Craft.t("sprout-seo","Delete")+'"></a></td></tr>'}}),Craft.SproutForms.EditableTable.Row=Garnish.Base.extend({table:null,id:null,niceTexts:null,$tr:null,$tds:null,$textareas:null,$deleteBtn:null,fieldRuleOptions:null,init:function(t,e,n){this.table=t,this.$tr=$(e),this.$tds=this.$tr.children(),this.fieldRuleOptions=n;var i=parseInt(this.$tr.attr("data-id").substr(this.table.settings.rowIdPrefix.length));i>this.table.biggestId&&(this.table.biggestId=i),this.$textareas=$(),this.niceTexts=[];var r={},o=this,s=0;for(var a in this.table.columns){var l=this.table.columns[a];if(Craft.inArray(l.type,Craft.SproutForms.EditableTable.textualColTypes)){var d=$("textarea",this.$tds[s]);this.$textareas=this.$textareas.add(d),this.addListener(d,"focus","onTextareaFocus"),this.addListener(d,"mousedown","ignoreNextTextareaFocus"),this.niceTexts.push(new Garnish.NiceText(d,{onHeightChange:$.proxy(this,"onTextareaHeightChange")})),"singleline"!==l.type&&"number"!==l.type||(this.addListener(d,"keypress",{type:l.type},"validateKeypress"),this.addListener(d,"textchange",{type:l.type},"validateValue")),r[a]=d}s++}for(var u in this.initSproutFields(),this.onTextareaHeightChange(),this.table.columns){var c=this.table.columns[u];c.autopopulate&&void 0!==r[c.autopopulate]&&!r[u].val()&&new Craft.HandleGenerator(r[u],r[c.autopopulate])}var f=this.$tr.find("td:eq(1)").find("select").data("check-value-html"),h=this.$tr.find("td:eq(0)").find("select"),p=this.$tr.find("td:eq(1)").find("select");h.change({row:this},(function(t){var e="";e+='<div class="select"><select data-check-value-html="true" name="'+name+'">';var n={};n.options=o.fieldRuleOptions[h.val()].conditionsAsOptions;var i=p.val(),r=!1,s="selected";for(var a in n.options){var l=n.options[a];if(void 0!==l.optgroup)r?e+="</optgroup>":r=!0,e+='<optgroup label="'+l.optgroup+'">';else{var d=void 0!==l.label?l.label:l,u=void 0!==l.value?l.value:a;e+="<option "+s+' value="'+u+'"'+(u===i?" selected":"")+(void 0!==l.disabled&&l.disabled?" disabled":"")+">"+d+"</option>"}s=""}r&&(e+="</optgroup>"),e+="</select></div>",p.html(e),o.addValueInputHtml(o)})),p.change({row:this},(function(t){o.addValueInputHtml(o)})),!0===f&&this.addValueInputHtml();var m=this.$tr.children().last().find(".delete");this.addListener(m,"click","deleteRow")},addValueInputHtml:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=null==t?this:t,n=0===this.$tr.find("td:eq(2)").find("input").length?this.$tr.find("td:eq(2)").find("select"):this.$tr.find("td:eq(2)").find("input"),i={formFieldHandle:this.$tr.find("td:eq(0)").find("select").val(),condition:this.$tr.find("td:eq(1)").find("select").val(),inputName:n.attr("name"),inputValue:n.val(),formId:$("#formId").val()};Craft.postActionRequest("sprout-forms/rules/get-condition-value-input-html",i,$.proxy((function(t,n){"success"===n&&t.success?e.$tr.find("td:eq(2)").html(t.html):Craft.cp.displayError(Craft.t("sprout-forms","Unable to get the input html"))}),this))},initSproutFields:function(){Craft.SproutFields.initFields(this.$tr)},onTextareaFocus:function(t){this.onTextareaHeightChange();var e=$(t.currentTarget);e.data("ignoreNextFocus")?e.data("ignoreNextFocus",!1):setTimeout((function(){var t=e.val();if(void 0!==e[0].setSelectionRange){var n=2*t.length;e[0].setSelectionRange(0,n)}else e.val(t)}),0)},ignoreNextTextareaFocus:function(t){$.data(t.currentTarget,"ignoreNextFocus",!0)},validateKeypress:function(t){var e=t.keyCode?t.keyCode:t.charCode;Garnish.isCtrlKeyPressed(t)||e!==Garnish.RETURN_KEY&&("number"!==t.data.type||Craft.inArray(e,Craft.SproutForms.EditableTable.Row.numericKeyCodes))||t.preventDefault()},validateValue:function(t){var e;if("number"===t.data.type){var n=t.currentTarget.value.match(/^\s*(-?[\d.]*)/);e=null!==n?n[1]:""}else e=t.currentTarget.value.replace(/[\r\n]/g,"");e!==t.currentTarget.value&&(t.currentTarget.value=e)},onTextareaHeightChange:function(){for(var t=-1,e=0;e<this.niceTexts.length;e++)this.niceTexts[e].height>t&&(t=this.niceTexts[e].height);this.$textareas.css("min-height",t);var n=this.$textareas.first().parent().height();n>t&&this.$textareas.css("min-height",n)},deleteRow:function(){if(this.table.sorter.removeItems(this.$tr),this.$tr.remove(),1===this.table.$table.find("tr").length){var t=this.table.$table.prev(".rules-table-and");1===t.length&&t.remove(),this.table.$table.remove()}this.table.settings.onDeleteRow(this.$tr)}},{numericKeyCodes:[9,8,37,38,39,40,45,91,46,190,48,49,50,51,52,53,54,55,56,57]})},function(t,e,n){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}"undefined"===i(Craft.SproutForms)&&(Craft.SproutForms={}),function(t){Craft.SproutForms.FormSettings=Garnish.Base.extend({options:null,modal:null,ruleModal:null,$lightswitches:null,init:function(){this.initButtons()},initButtons:function(){var e=this;t("a[id^='sproutform-integration']").each((function(n,i){var r=t(i).data("integrationid");r&&e.addListener(t("#sproutform-integration-"+r),"activate","editIntegration")})),t("a[id^='sproutform-rules']").each((function(n,i){var r=t(i).data("ruleId");r&&e.addListener(t("#sproutform-rules-"+r),"activate","editRule")})),this.$lightswitches=t(".sproutforms-integration-row .lightswitch"),this.addListener(this.$lightswitches,"click","onEnableIntegration"),this.$ruleEnabledLightswitches=t(".sproutforms-rules-row .lightswitch"),this.addListener(this.$ruleEnabledLightswitches,"click","onEnableRule"),this.modal=Craft.SproutForms.IntegrationModal.getInstance(),this.modal.on("saveIntegration",t.proxy((function(t){var e=t.integration;this.resetIntegration(e)}),this)),this.ruleModal=Craft.SproutForms.RuleModal.getInstance(),this.ruleModal.on("saveRule",t.proxy((function(t){var e=t.rule;this.resetConditional(e)}),this)),this.addListener(t("#integrationsOptions"),"change","createDefaultIntegration"),this.addListener(t("#ruleOptions"),"change","createDefaultRule")},onEnableIntegration:function(e){var n=e.currentTarget,i=n.id,r=t(n).attr("aria-checked"),o={integrationId:i,enabled:r="true"===r?1:0,formId:t("#formId").val()};Craft.postActionRequest("sprout-forms/integrations/enable-integration",o,t.proxy((function(t,e){"success"===e&&t.success?Craft.cp.displayNotice(Craft.t("sprout-forms","Integration updated.")):Craft.cp.displayError(Craft.t("sprout-forms","Unable to update integration"))}),this))},onEnableRule:function(e){var n=e.currentTarget,i=n.id,r=t(n).attr("aria-checked"),o={ruleId:i,enabled:r="true"===r?1:0,formId:t("#formId").val()};Craft.postActionRequest("sprout-forms/rules/enable-rule",o,t.proxy((function(t,e){"success"===e&&t.success?Craft.cp.displayNotice(Craft.t("sprout-forms","Conditional updated.")):Craft.cp.displayError(Craft.t("sprout-forms","Unable to update conditional"))}),this))},resetIntegration:function(e){var n=t("#sproutform-integration-"+e.id),i=t("#integration-enabled-"+e.id),r="1"===e.enabled;r!==("true"===i.attr("aria-checked"))&&(i.attr("aria-checked",""+r),r?i.addClass("on"):i.removeClass("on")),n.html(e.name)},resetConditional:function(e){var n=t("#sproutform-rules-"+e.id),i=t("#condition-enabled-"+e.id),r=t("#sproutform-rules-behavior-"+e.id),o="1"===e.enabled;o!==("true"===i.attr("aria-checked"))&&(i.attr("aria-checked",""+o),o?i.addClass("on"):i.removeClass("on")),r.html(e.behavior),n.html(e.name)},createDefaultIntegration:function(e){var n=this,i=t("#sproutforms-integrations-table tbody"),r=t("#integrationsOptions").val(),o=t("#formId").val();if(""!==r){var s={type:r,formId:o,sendRule:"*"};Craft.postActionRequest("sprout-forms/integrations/save-integration",s,t.proxy((function(e,r){if("success"===r){var o=e.integration;i.append('<tr class="field sproutforms-integration-row" id ="sproutforms-integration-row-'+o.id+'"><td class="heading"><a href="#" id ="sproutform-integration-'+o.id+'" data-integrationid="'+o.id+'">'+o.name+'</a></td><td><div class="lightswitch small" tabindex="0" data-value="1" role="checkbox" aria-checked="false" id ="integration-enabled-'+o.id+'"><div class="lightswitch-container"><div class="label on"></div><div class="handle"></div><div class="label off"></div></div><input type="hidden" name="" value=""></div></td></tr>'),n.addListener(t("#sproutform-integration-"+o.id),"activate","editIntegration"),t("#integrationsOptions").val("");var s=t("#integration-enabled-"+o.id);s.lightswitch(),n.addListener(s,"click","onEnableIntegration")}}),this))}},createDefaultRule:function(e){var n=this,i=t("#sproutforms-rules-table tbody"),r=t("#ruleOptions").val(),o=t("#formId").val();if(""!==r){var s={type:r,formId:o};Craft.postActionRequest("sprout-forms/rules/save-rule",s,t.proxy((function(e,r){if("success"===r){var o=e.rule;i.append('<tr id ="sproutforms-rules-row-'+o.id+'" class="field sproutforms-rules-row"><td><a href="#" id ="sproutform-rules-'+o.id+'" data-rule-id="'+o.id+'">'+o.name+'</a></td><td><div id ="sproutform-rules-behavior-'+o.id+'">'+o.behavior+'</div></td><td><div class="lightswitch small" tabindex="0" data-value="1" role="checkbox" aria-checked="false" id ="condition-enabled-'+o.id+'"><div class="lightswitch-container"><div class="label on"></div><div class="handle"></div><div class="label off"></div></div><input type="hidden" name="" value=""></div></td></tr>'),n.addListener(t("#sproutform-rules-"+o.id),"activate","editRule"),t("#ruleOptions").val("");var s=t("#condition-enabled-"+o.id);s.lightswitch(),n.addListener(s,"click","onEnableRule")}}),this))}},editRule:function(e){var n=e.currentTarget,i=t(n).data("ruleId");this.base(t(n)),this.ruleModal.editRule(i)},editIntegration:function(e){var n=e.currentTarget,i=t(n).data("integrationid");this.base(t(n)),this.modal.editIntegration(i)}})}(jQuery)},function(t,e,n){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var s=n(6),a=n(18);!function(t){var e=function(){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),void 0===window.sproutforms&&(window.sproutforms={}),this.formId=n,this.$formPage=t("body.sprout-forms"),this.$formPageManagerBtn=t("#formPageManagerBtn"),this.$addFormPageBtn=t("#addFormPageBtn"),this.$saveFormButton=t("#save-form-button"),this.$revisionSpinner=t("#revision-spinner"),this.$revisionStatus=t("#revision-status"),this.selectedTab=Craft.cp.$selectedTab,this.selectedTabId=this.selectedTab?this.selectedTab.parent().data("id"):null,this.formPageManagerTabs=[],this.fieldModal=Craft.SproutForms.FieldModal.getInstance(),this.initGlobalButtons(),this.resizeContainers(),this.initFieldLayout(),this.initDragula()}var n,l,d;return n=e,(l=[{key:"initGlobalButtons",value:function(){var e=this;this.$formPageManagerBtn.on("click",(function(){e.showFormPageManager()})),this.$addFormPageBtn.on("click",(function(){e.addFormPage()})),this.$formPage.on("refreshFieldLayout",(function(){e.refreshFieldLayout()})),Garnish.$win.on("scroll",(function(){e.resizeContainers()})),window.addEventListener("resize",(function(){e.resizeContainers()})),this.fieldModal.on("saveField",(function(e){t("body.sprout-forms").trigger("refreshFieldLayout")}))}},{key:"initFieldLayout",value:function(){var e=this,n=t("a[id^='sproutform-field-']"),i=!0,r=!1,o=void 0;try{for(var s,a=n[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var l=s.value,d=t(l).data("fieldid");d&&t("#sproutform-field-"+d).on("activate",(function(t){e.showEditFieldModal(t)}))}}catch(t){r=!0,o=t}finally{try{i||null==a.return||a.return()}finally{if(r)throw o}}}},{key:"initDragula",value:function(){var e=this;void 0!==window.sproutforms.formBuilder&&window.sproutforms.formBuilder.destroy(),this.fieldsLayout=document.getElementById("right-copy"),this.tabContainers=document.querySelectorAll(".sprout-tab-container");var n=[this.fieldsLayout].concat(r(this.tabContainers));window.sproutforms.formBuilder=s(n,{copy:function(t,n){return n===e.fieldsLayout},accepts:function(t,n){return n!==e.fieldsLayout},invalid:function(t,e){return t.classList.contains("donotdrag")}}).on("drag",(function(e){t(e).addClass("drag-active")})).on("drop",(function(n,i,r){if(t(n).removeClass("drag-active"),t(i).find(".drag-active").removeClass("drag-active"),t(r).find(".drag-active").removeClass("drag-active"),e.$revisionStatus.addClass("invisible"),e.$revisionSpinner.removeClass("hidden"),t(i).attr("id")===t(r).attr("id")&&e.$revisionStatus.addClass("checkmark-icon unsaved").fadeIn("slow"),i&&r===e.fieldsLayout){var o=t(n).closest(".sproutforms-tab-fields"),s=o.data("tabname"),a=o.data("tabid"),l=t(n).data("type");e.createDefaultField(l,a,s,n)}setTimeout((function(){e.$revisionSpinner.addClass("hidden"),e.$revisionStatus.removeClass("invisible")}),500)})).on("over",(function(e,n){t(e).addClass("drag-active"),t(n).addClass("container-active")})).on("out",(function(e,n){t(e).removeClass("drag-active"),t(n).removeClass("container-active")})),a(r(document.querySelectorAll(".sproutforms-tab-fields")),{margin:20,maxSpeed:10,scrollWhenOutside:!0,autoScroll:function(){return this.down&&window.sproutforms.formBuilder.dragging}})}},{key:"resizeContainers",value:function(){var e=t("#global-header"),n=t("#tabs"),i=t("#content-container"),r=t("body"),o=0;Garnish.$bod.hasClass("fixed-header")?r.addClass("sproutforms-editor-adjust-fixed-header"):(o=e.outerHeight(!0),r.removeClass("sproutforms-editor-adjust-fixed-header"));var s=t("#header-container").outerHeight(!0),a=n.outerHeight(),l=92;Garnish.$bod.hasClass("fixed-header")&&(l=92);var d=o+s+a+l;t(".sproutforms-tab-fields").height(t(window).height()-d),t("#details-container").height(i.height())}},{key:"createDefaultField",value:function(e,n,i,r){var o=this;o.newTabName=i,o.newFieldElement=r,t(r).removeClass("source-field"),t(r).addClass("target-field"),t(r).find(".source-field-header").remove(),t(r).find(".body").removeClass("hidden");var s=t(r).next(".target-field"),a=s.attr("id");if(null==a)s=null;else{var l=a.split("-");a=l[1]}var d=t(r).data("defaultname")?t(r).data("defaultname"):Craft.t("sprout-forms","Untitled Field");t(r).prepend(t(['<div class="active-field-header">',"<h2>",d,"</h2>","</div>"].join("")));var u={type:e,formId:t("#formId").val(),tabId:n,nextId:a};Craft.postActionRequest("sprout-forms/fields/create-field",u,(function(t,e){"success"===e&&o.initFieldOnDrop(t.field,o.newTabName,o.newFieldElement)}))}},{key:"initFieldOnDrop",value:function(e,n,i){var r=this;null!==e&&e.hasOwnProperty("id")?(t(i).attr("id","sproutfield-"+e.id),t(i).prepend(t(['<ul class="settings">','<li><a id="sproutform-field-',e.id,'" data-fieldid="',e.id,'" href="#" tabindex="0" ><i class="fa fa-pencil fa-2x" title="',Craft.t("sprout-forms","Edit"),'"></i></a></li>',"</ul>"].join(""))),t(i).append(t(['<input type="hidden" name="fieldLayout[',n,'][]" value="',e.id,'" class="id-input">'].join(""))),t("#sproutform-field-"+e.id).on("activate",(function(t){r.showEditFieldModal(t)}))):(Craft.cp.displayError(Craft.t("sprout-forms","Something went wrong when creating the field :(")),t(i).remove())}},{key:"showEditFieldModal",value:function(e){var n=e.currentTarget,i=t(n).data("fieldid");this.fieldModal.editField(i)}},{key:"showFormPageManager",value:function(){var t=this;if(window.sproutforms.formPageManager)window.sproutforms.formPageManager.show();else{var e,n=null!==(e=Craft.cp.$tabs)&&void 0!==e?e:[];this.buildFormPageManagerElements(n),window.sproutforms.formPageManager=new Garnish.HUD(this.$formPageManagerBtn,this.$formPageManagerForm,{hudClass:"hud formpagemanagerhud",onShow:function(){t.$formPageManagerBtn.addClass("active")},onHide:function(){t.$formPageManagerBtn.removeClass("active")}}),this.initFormPageManagerAdminTable()}}},{key:"buildFormPageManagerElements",value:function(e){var n=this;this.$formPageManagerForm=null,this.$formPageManagerNoTabs=null,this.$formPageManagerTable=null,this.$formPageManagerForm=t('<form method="post" accept-charset="UTF-8"><input type="hidden" name="action" value="sprout-forms/forms/save-form-page"/></form>'),this.$formPageManagerForm.appendTo(Garnish.$bod),this.$formPageManagerNoTabs=t('<p id="notabs"'+(e.length?' class="hidden"':"")+">"+Craft.t("sprout-forms","You don’t have any tabs yet.")+"</p>"),this.$formPageManagerNoTabs.appendTo(this.$formPageManagerForm),this.$formPageManagerTable=t('<table class="data'+(e.length?"":" hidden")+'"/>'),this.$formPageManagerTable.appendTo(this.$formPageManagerForm);var i=t("<tbody/>").appendTo(this.$formPageManagerTable),r=!0,o=!1,s=void 0;try{for(var a,l=e[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var d=a.value,u=d.getAttribute("data-id"),c=n.getFormManagerTableRow(u,d,e.length);c.find("> td.formpagemanagerhud-col-rename").on("click",(function(t){n.renameFormPage(t)})),n.formPageManagerTabs[u]=c,c.appendTo(i)}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}}},{key:"initFormPageManagerAdminTable",value:function(){var t=this;window.sproutforms.formPageManager.adminTable=new Craft.AdminTable({tableSelector:t.$formPageManagerTable,noObjectsSelector:t.$formPageManagerNoTabs,sortable:!0,reorderAction:"sprout-forms/forms/reorder-form-tabs",reorderSuccessMessage:Craft.t("sprout-forms","Items reordered."),reorderFailMessage:Craft.t("sprout-forms","Couldn’t reorder items."),deleteAction:"sprout-forms/forms/delete-form-tab",confirmDeleteMessage:Craft.t("sprout-forms","Are you sure you want to delete this tab, all of it's fields, and all of it's data?"),onReorderItems:function(e){t.currentTabName=Craft.cp.$selectedTab.text(),t.refreshFieldLayout()},onDeleteItem:function(e){t.currentTabName=Craft.cp.$selectedTab.text(),t.refreshFieldLayout()}})}},{key:"addFormPage",value:function(){var t=this;if(t.newTabName=prompt(Craft.t("sprout-forms","Page Name")),null!==t.newTabName){var e={formId:t.formId,name:t.newTabName};t.$revisionStatus.addClass("invisible"),t.$revisionSpinner.removeClass("hidden"),Craft.postActionRequest("sprout-forms/forms/add-form-tab",e,(function(e){t.$revisionSpinner.addClass("hidden"),t.$revisionStatus.removeClass("invisible"),t.$revisionStatus.addClass("checkmark-icon"),e.success?(t.currentTabName="last",t.refreshFieldLayout()):Craft.cp.displayError(Craft.t("sprout-forms","Unable to add page."))}))}}},{key:"renameFormPage",value:function(e){var n=this,i=t(e.currentTarget).parent(),r=i.find(".formpagemanagerhud-col-page-name").text();this.newTabName=prompt(Craft.t("sprout-forms","Test"),r);var o=i.data("id");if(null!==this.newTabName){var s={tabId:o,newName:this.newTabName};Craft.postActionRequest("sprout-forms/forms/rename-form-tab",s,(function(t){t.success?(n.currentTabName=n.newTabName,n.refreshFieldLayout(),Craft.cp.displayNotice(Craft.t("sprout-forms","Page renamed."))):Craft.cp.displayError(Craft.t("sprout-forms","Unable to rename page."))})),this.newTabName&&this.newTabName!==r&&(t('li[data-id="'+o+'"] a').text(this.newTabName),i.find(".formpagemanagerhud-col-page-name").text(this.newTabName)),Craft.cp.initTabs()}}},{key:"getFormManagerTableRow",value:function(e,n,i){var r=n.querySelector("a").innerText;return t('<tr data-id="'+e+'" data-name="'+Craft.escapeHtml(r)+'"><td class="formpagemanagerhud-col-page-name">'+r+'</td><td class="formpagemanagerhud-col-rename thin"><a class="edit icon" title="'+Craft.t("sprout-forms","Rename")+'" role="button"></a></td>'+(i>1?'<td class="formpagemanagerhud-col-move thin"><a class="move icon" title="'+Craft.t("sprout-forms","Reorder")+'" role="button"></a></td>':"")+(i>1?'<td class="thin"><a class="delete icon" title="'+Craft.t("app","Delete")+'" role="button"></a></td>':"")+"</tr>")}},{key:"refreshFieldLayout",value:function(){var e=this;this.$newTabs=null;var n={formId:this.formId};e.$revisionStatus.addClass("invisible"),e.$revisionSpinner.removeClass("hidden"),Craft.postActionRequest("sprout-forms/forms/get-updated-layout-html",n,(function(n){if(n.success){var i=t("#tabs");i.length?i.replaceWith(n.tabsHtml):t(n.tabsHtml).insertBefore(t("#content")),t("#sproutforms-fieldlayout-container").html(n.contentHtml),Craft.initUiElements(t("#content")),Craft.appendHeadHtml(n.headHtml),Craft.appendFootHtml(n.bodyHtml),Craft.cp.initTabs(),e.initFieldLayout(),e.initDragula(),window.sproutforms.formPageManager&&(e.buildFormPageManagerElements(Craft.cp.$tabs),window.sproutforms.formPageManager.updateBody(e.$formPageManagerForm),e.initFormPageManagerAdminTable());var r=e.getCurrentTabByName();return null!==r&&r.find("a").trigger("click"),e.$revisionSpinner.addClass("hidden"),e.$revisionStatus.addClass("checkmark-icon"),e.$revisionStatus.removeClass("invisible unsaved"),!0}return!1}))}},{key:"getCurrentTabByName",value:function(){if(void 0===i(this.currentTabName))return null;if("last"===this.currentTabName){var e=t(Craft.cp.$tabs[Craft.cp.$tabs.length-1]);this.currentTabName=e.text().trim()}var n=!0,r=!1,o=void 0;try{for(var s,a=Craft.cp.$tabs[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,d=t(l);if(d.find("a").attr("title")===this.currentTabName)return d}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return null}},{key:"isInViewport",value:function(e){var n=e.offset().top,i=e.offset().top+e.outerHeight(),r=t(window).scrollTop()+t(window).innerHeight(),o=t(window).scrollTop();return r>n&&o<i}}])&&o(n.prototype,l),d&&o(n,d),e}();window.SproutFormsFieldLayoutEditor=e}(jQuery)},function(t,e,n){"use strict";(function(e){var i=n(7),r=n(14),o=n(17),s=document,a=s.documentElement;function l(t,n,i,o){e.navigator.pointerEnabled?r[n](t,{mouseup:"pointerup",mousedown:"pointerdown",mousemove:"pointermove"}[i],o):e.navigator.msPointerEnabled?r[n](t,{mouseup:"MSPointerUp",mousedown:"MSPointerDown",mousemove:"MSPointerMove"}[i],o):(r[n](t,{mouseup:"touchend",mousedown:"touchstart",mousemove:"touchmove"}[i],o),r[n](t,i,o))}function d(t){if(void 0!==t.touches)return t.touches.length;if(void 0!==t.which&&0!==t.which)return t.which;if(void 0!==t.buttons)return t.buttons;var e=t.button;return void 0!==e?1&e?1:2&e?3:4&e?2:0:void 0}function u(t){var e=t.getBoundingClientRect();return{left:e.left+c("scrollLeft","pageXOffset"),top:e.top+c("scrollTop","pageYOffset")}}function c(t,n){return void 0!==e[n]?e[n]:a.clientHeight?a[t]:s.body[t]}function f(t,e,n){var i,r=t||{},o=r.className;return r.className+=" gu-hide",i=s.elementFromPoint(e,n),r.className=o,i}function h(){return!1}function p(){return!0}function m(t){return t.width||t.right-t.left}function v(t){return t.height||t.bottom-t.top}function g(t){return t.parentNode===s?null:t.parentNode}function b(t){return"INPUT"===t.tagName||"TEXTAREA"===t.tagName||"SELECT"===t.tagName||function t(e){if(!e)return!1;if("false"===e.contentEditable)return!1;if("true"===e.contentEditable)return!0;return t(g(e))}(t)}function y(t){return t.nextElementSibling||function(){var e=t;do{e=e.nextSibling}while(e&&1!==e.nodeType);return e}()}function $(t,e){var n=function(t){return t.targetTouches&&t.targetTouches.length?t.targetTouches[0]:t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t}(e),i={pageX:"clientX",pageY:"clientY"};return t in i&&!(t in n)&&i[t]in n&&(t=i[t]),n[t]}t.exports=function(t,e){var n,c,w,C,T,S,x,E,F,L,B,I=arguments.length;1===I&&!1===Array.isArray(t)&&(e=t,t=[]);var O,M=null,A=e||{};void 0===A.moves&&(A.moves=p),void 0===A.accepts&&(A.accepts=p),void 0===A.invalid&&(A.invalid=J),void 0===A.containers&&(A.containers=t||[]),void 0===A.isContainer&&(A.isContainer=h),void 0===A.copy&&(A.copy=!1),void 0===A.copySortSource&&(A.copySortSource=!1),void 0===A.revertOnSpill&&(A.revertOnSpill=!1),void 0===A.removeOnSpill&&(A.removeOnSpill=!1),void 0===A.direction&&(A.direction="vertical"),void 0===A.ignoreInputTextSelection&&(A.ignoreInputTextSelection=!0),void 0===A.mirrorContainer&&(A.mirrorContainer=s.body);var j=i({containers:A.containers,start:G,end:K,cancel:Z,remove:Q,destroy:q,canMove:Y,dragging:!1});return!0===A.removeOnSpill&&j.on("over",rt).on("out",ot),k(),j;function R(t){return-1!==j.containers.indexOf(t)||A.isContainer(t)}function k(t){var e=t?"remove":"add";l(a,e,"mousedown",H),l(a,e,"mouseup",V)}function P(t){l(a,t?"remove":"add","mousemove",_)}function N(t){var e=t?"remove":"add";r[e](a,"selectstart",D),r[e](a,"click",D)}function q(){k(!0),V({})}function D(t){O&&t.preventDefault()}function H(t){if(S=t.clientX,x=t.clientY,!(1!==d(t)||t.metaKey||t.ctrlKey)){var e=t.target,n=X(e);n&&(O=n,P(),"mousedown"===t.type&&(b(e)?e.focus():t.preventDefault()))}}function _(t){if(O)if(0!==d(t)){if(void 0===t.clientX||t.clientX!==S||void 0===t.clientY||t.clientY!==x){if(A.ignoreInputTextSelection){var e=$("clientX",t),n=$("clientY",t);if(b(s.elementFromPoint(e,n)))return}var i=O;P(!0),N(),K(),z(i);var r=u(w);C=$("pageX",t)-r.left,T=$("pageY",t)-r.top,o.add(L||w,"gu-transit"),st(),it(t)}}else V({})}function X(t){if(!(j.dragging&&n||R(t))){for(var e=t;g(t)&&!1===R(g(t));){if(A.invalid(t,e))return;if(!(t=g(t)))return}var i=g(t);if(i)if(!A.invalid(t,e))if(A.moves(t,i,e,y(t)))return{item:t,source:i}}}function Y(t){return!!X(t)}function G(t){var e=X(t);e&&z(e)}function z(t){ut(t.item,t.source)&&(L=t.item.cloneNode(!0),j.emit("cloned",L,t.item,"copy")),c=t.source,w=t.item,E=F=y(t.item),j.dragging=!0,j.emit("drag",w,c)}function J(){return!1}function K(){if(j.dragging){var t=L||w;W(t,g(t))}}function U(){O=!1,P(!0),N(!0)}function V(t){if(U(),j.dragging){var e=L||w,i=$("clientX",t),r=$("clientY",t),o=nt(f(n,i,r),i,r);o&&(L&&A.copySortSource||!L||o!==c)?W(e,o):A.removeOnSpill?Q():Z()}}function W(t,e){var n=g(t);L&&A.copySortSource&&e===c&&n.removeChild(w),et(e)?j.emit("cancel",t,c,c):j.emit("drop",t,e,c,F),tt()}function Q(){if(j.dragging){var t=L||w,e=g(t);e&&e.removeChild(t),j.emit(L?"cancel":"remove",t,e,c),tt()}}function Z(t){if(j.dragging){var e=arguments.length>0?t:A.revertOnSpill,n=L||w,i=g(n),r=et(i);!1===r&&e&&(L?i&&i.removeChild(L):c.insertBefore(n,E)),r||e?j.emit("cancel",n,c,c):j.emit("drop",n,i,c,F),tt()}}function tt(){var t=L||w;U(),at(),t&&o.rm(t,"gu-transit"),B&&clearTimeout(B),j.dragging=!1,M&&j.emit("out",t,M,c),j.emit("dragend",t),c=w=L=E=F=B=M=null}function et(t,e){var i;return i=void 0!==e?e:n?F:y(L||w),t===c&&i===E}function nt(t,e,n){for(var i=t;i&&!r();)i=g(i);return i;function r(){if(!1===R(i))return!1;var r=lt(i,t),o=dt(i,r,e,n);return!!et(i,o)||A.accepts(w,i,c,o)}}function it(t){if(n){t.preventDefault();var e=$("clientX",t),i=$("clientY",t),r=e-C,o=i-T;n.style.left=r+"px",n.style.top=o+"px";var s=L||w,a=f(n,e,i),l=nt(a,e,i),d=null!==l&&l!==M;(d||null===l)&&(M&&m("out"),M=l,d&&m("over"));var u=g(s);if(l!==c||!L||A.copySortSource){var h,p=lt(l,a);if(null!==p)h=dt(l,p,e,i);else{if(!0!==A.revertOnSpill||L)return void(L&&u&&u.removeChild(s));h=E,l=c}(null===h&&d||h!==s&&h!==y(s))&&(F=h,l.insertBefore(s,h),j.emit("shadow",s,l,c))}else u&&u.removeChild(s)}function m(t){j.emit(t,s,M,c)}}function rt(t){o.rm(t,"gu-hide")}function ot(t){j.dragging&&o.add(t,"gu-hide")}function st(){if(!n){var t=w.getBoundingClientRect();(n=w.cloneNode(!0)).style.width=m(t)+"px",n.style.height=v(t)+"px",o.rm(n,"gu-transit"),o.add(n,"gu-mirror"),A.mirrorContainer.appendChild(n),l(a,"add","mousemove",it),o.add(A.mirrorContainer,"gu-unselectable"),j.emit("cloned",n,w,"mirror")}}function at(){n&&(o.rm(A.mirrorContainer,"gu-unselectable"),l(a,"remove","mousemove",it),g(n).removeChild(n),n=null)}function lt(t,e){for(var n=e;n!==t&&g(n)!==t;)n=g(n);return n===a?null:n}function dt(t,e,n,i){var r="horizontal"===A.direction;return e!==t?function(){var t=e.getBoundingClientRect();if(r)return o(n>t.left+m(t)/2);return o(i>t.top+v(t)/2)}():function(){var e,o,s,a=t.children.length;for(e=0;e<a;e++){if(o=t.children[e],s=o.getBoundingClientRect(),r&&s.left+s.width/2>n)return o;if(!r&&s.top+s.height/2>i)return o}return null}();function o(t){return t?y(e):e}}function ut(t,e){return"boolean"==typeof A.copy?A.copy:A.copy(t,e)}}}).call(this,n(0))},function(t,e,n){"use strict";var i=n(8),r=n(9);t.exports=function(t,e){var n=e||{},o={};return void 0===t&&(t={}),t.on=function(e,n){return o[e]?o[e].push(n):o[e]=[n],t},t.once=function(e,n){return n._once=!0,t.on(e,n),t},t.off=function(e,n){var i=arguments.length;if(1===i)delete o[e];else if(0===i)o={};else{var r=o[e];if(!r)return t;r.splice(r.indexOf(n),1)}return t},t.emit=function(){var e=i(arguments);return t.emitterSnapshot(e.shift()).apply(this,e)},t.emitterSnapshot=function(e){var s=(o[e]||[]).slice(0);return function(){var o=i(arguments),a=this||t;if("error"===e&&!1!==n.throws&&!s.length)throw 1===o.length?o[0]:o;return s.forEach((function(i){n.async?r(i,o,a):i.apply(a,o),i._once&&t.off(e,i)})),t}},t}},function(t,e){t.exports=function(t,e){return Array.prototype.slice.call(t,e)}},function(t,e,n){"use strict";var i=n(10);t.exports=function(t,e,n){t&&i((function(){t.apply(n||null,e||[])}))}},function(t,e,n){(function(e){var n;n="function"==typeof e?function(t){e(t)}:function(t){setTimeout(t,0)},t.exports=n}).call(this,n(11).setImmediate)},function(t,e,n){(function(t){var i=void 0!==t&&t||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function o(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new o(r.call(setTimeout,i,arguments),clearTimeout)},e.setInterval=function(){return new o(r.call(setInterval,i,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(i,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout((function(){t._onTimeout&&t._onTimeout()}),e))},n(12),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,n(0))},function(t,e,n){(function(t,e){!function(t,n){"use strict";if(!t.setImmediate){var i,r,o,s,a,l=1,d={},u=!1,c=t.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(t);f=f&&f.setTimeout?f:t,"[object process]"==={}.toString.call(t.process)?i=function(t){e.nextTick((function(){p(t)}))}:!function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?t.MessageChannel?((o=new MessageChannel).port1.onmessage=function(t){p(t.data)},i=function(t){o.port2.postMessage(t)}):c&&"onreadystatechange"in c.createElement("script")?(r=c.documentElement,i=function(t){var e=c.createElement("script");e.onreadystatechange=function(){p(t),e.onreadystatechange=null,r.removeChild(e),e=null},r.appendChild(e)}):i=function(t){setTimeout(p,0,t)}:(s="setImmediate$"+Math.random()+"$",a=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(s)&&p(+e.data.slice(s.length))},t.addEventListener?t.addEventListener("message",a,!1):t.attachEvent("onmessage",a),i=function(e){t.postMessage(s+e,"*")}),f.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var r={callback:t,args:e};return d[l]=r,i(l),l++},f.clearImmediate=h}function h(t){delete d[t]}function p(t){if(u)setTimeout(p,0,t);else{var e=d[t];if(e){u=!0;try{!function(t){var e=t.callback,n=t.args;switch(n.length){case 0:e();break;case 1:e(n[0]);break;case 2:e(n[0],n[1]);break;case 3:e(n[0],n[1],n[2]);break;default:e.apply(void 0,n)}}(e)}finally{h(t),u=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,n(0),n(13))},function(t,e){var n,i,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(t){i=s}}();var l,d=[],u=!1,c=-1;function f(){u&&l&&(u=!1,l.length?d=l.concat(d):c=-1,d.length&&h())}function h(){if(!u){var t=a(f);u=!0;for(var e=d.length;e;){for(l=d,d=[];++c<e;)l&&l[c].run();c=-1,e=d.length}l=null,u=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function m(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];d.push(new p(t,e)),1!==d.length||u||a(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e,n){"use strict";(function(e){var i=n(15),r=n(16),o=e.document,s=function(t,e,n,i){return t.addEventListener(e,n,i)},a=function(t,e,n,i){return t.removeEventListener(e,n,i)},l=[];function d(t,e,n){var i=function(t,e,n){var i,r;for(i=0;i<l.length;i++)if((r=l[i]).element===t&&r.type===e&&r.fn===n)return i}(t,e,n);if(i){var r=l[i].wrapper;return l.splice(i,1),r}}e.addEventListener||(s=function(t,n,i){return t.attachEvent("on"+n,function(t,n,i){var r=d(t,n,i)||function(t,n,i){return function(n){var r=n||e.event;r.target=r.target||r.srcElement,r.preventDefault=r.preventDefault||function(){r.returnValue=!1},r.stopPropagation=r.stopPropagation||function(){r.cancelBubble=!0},r.which=r.which||r.keyCode,i.call(t,r)}}(t,0,i);return l.push({wrapper:r,element:t,type:n,fn:i}),r}(t,n,i))},a=function(t,e,n){var i=d(t,e,n);if(i)return t.detachEvent("on"+e,i)}),t.exports={add:s,remove:a,fabricate:function(t,e,n){var s=-1===r.indexOf(e)?new i(e,{detail:n}):function(){var t;o.createEvent?(t=o.createEvent("Event")).initEvent(e,!0,!0):o.createEventObject&&(t=o.createEventObject());return t}();t.dispatchEvent?t.dispatchEvent(s):t.fireEvent("on"+e,s)}}}).call(this,n(0))},function(t,e,n){(function(e){var n=e.CustomEvent;t.exports=function(){try{var t=new n("cat",{detail:{foo:"bar"}});return"cat"===t.type&&"bar"===t.detail.foo}catch(t){}return!1}()?n:"function"==typeof document.createEvent?function(t,e){var n=document.createEvent("CustomEvent");return e?n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail):n.initCustomEvent(t,!1,!1,void 0),n}:function(t,e){var n=document.createEventObject();return n.type=t,e?(n.bubbles=Boolean(e.bubbles),n.cancelable=Boolean(e.cancelable),n.detail=e.detail):(n.bubbles=!1,n.cancelable=!1,n.detail=void 0),n}}).call(this,n(0))},function(t,e,n){"use strict";(function(e){var n=[],i="",r=/^on/;for(i in e)r.test(i)&&n.push(i.slice(2));t.exports=n}).call(this,n(0))},function(t,e,n){"use strict";var i={};function r(t){var e=i[t];return e?e.lastIndex=0:i[t]=e=new RegExp("(?:^|\\s)"+t+"(?:\\s|$)","g"),e}t.exports={add:function(t,e){var n=t.className;n.length?r(e).test(n)||(t.className+=" "+e):t.className=e},rm:function(t,e){t.className=t.className.replace(r(e)," ").trim()}}},function(t,e,n){"use strict";var i,r=n(1),o=n(19),s=n(20),a=n(25),l=(i=n(27))&&"object"==typeof i&&"default"in i?i.default:i;function d(t,e){void 0===e&&(e={});var n=this,i=4,d=!1;this.margin=e.margin||-1,this.scrollWhenOutside=e.scrollWhenOutside||!1;var c={},f=a.createPointCB(c),h=l(),p=!1;window.addEventListener("mousemove",f,!1),window.addEventListener("touchmove",f,!1),isNaN(e.maxSpeed)||(i=e.maxSpeed),this.autoScroll=r.boolean(e.autoScroll),this.syncMove=r.boolean(e.syncMove,!1),this.destroy=function(e){window.removeEventListener("mousemove",f,!1),window.removeEventListener("touchmove",f,!1),window.removeEventListener("mousedown",w,!1),window.removeEventListener("touchstart",w,!1),window.removeEventListener("mouseup",C,!1),window.removeEventListener("touchend",C,!1),window.removeEventListener("pointerup",C,!1),window.removeEventListener("mouseleave",S,!1),window.removeEventListener("mousemove",E,!1),window.removeEventListener("touchmove",E,!1),window.removeEventListener("scroll",$,!0),t=[],e&&T()},this.add=function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return s.addElements.apply(void 0,[t].concat(e)),this},this.remove=function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return s.removeElements.apply(void 0,[t].concat(e))};var m,v,g=null;"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]),v=t,t=[],v.forEach((function(t){t===window?g=window:n.add(t)})),Object.defineProperties(this,{down:{get:function(){return p}},maxSpeed:{get:function(){return i}},point:{get:function(){return c}},scrolling:{get:function(){return d}}});var b,y=null;function $(e){for(var n=0;n<t.length;n++)if(t[n]===e.target){d=!0;break}d&&o.requestAnimationFrame((function(){return d=!1}))}function w(){p=!0}function C(){p=!1,T()}function T(){o.cancelAnimationFrame(b),o.cancelAnimationFrame(m)}function S(){p=!1}function x(){for(var e=null,n=0;n<t.length;n++)u(c,t[n])&&(e=t[n]);return e}function E(e){if(n.autoScroll()&&!e.dispatched){var i=e.target,r=document.body;y&&!u(c,y)&&(n.scrollWhenOutside||(y=null)),i&&i.parentNode===r?i=x():(i=function(e){if(!e)return null;if(y===e)return e;if(s.hasElement(t,e))return e;for(;e=e.parentNode;)if(s.hasElement(t,e))return e;return null}(i))||(i=x()),i&&i!==y&&(y=i),g&&(o.cancelAnimationFrame(m),m=o.requestAnimationFrame(F)),y&&(o.cancelAnimationFrame(b),b=o.requestAnimationFrame(L))}}function F(){B(g),o.cancelAnimationFrame(m),m=o.requestAnimationFrame(F)}function L(){y&&(B(y),o.cancelAnimationFrame(b),b=o.requestAnimationFrame(L))}function B(t){var e,i,r=a.getClientRect(t);e=c.x<r.left+n.margin?Math.floor(Math.max(-1,(c.x-r.left)/n.margin-1)*n.maxSpeed):c.x>r.right-n.margin?Math.ceil(Math.min(1,(c.x-r.right)/n.margin+1)*n.maxSpeed):0,i=c.y<r.top+n.margin?Math.floor(Math.max(-1,(c.y-r.top)/n.margin-1)*n.maxSpeed):c.y>r.bottom-n.margin?Math.ceil(Math.min(1,(c.y-r.bottom)/n.margin+1)*n.maxSpeed):0,n.syncMove()&&h.dispatch(t,{pageX:c.pageX+e,pageY:c.pageY+i,clientX:c.x+e,clientY:c.y+i}),setTimeout((function(){i&&function(t,e){t===window?window.scrollTo(t.pageXOffset,t.pageYOffset+e):t.scrollTop+=e}(t,i),e&&function(t,e){t===window?window.scrollTo(t.pageXOffset+e,t.pageYOffset):t.scrollLeft+=e}(t,e)}))}window.addEventListener("mousedown",w,!1),window.addEventListener("touchstart",w,!1),window.addEventListener("mouseup",C,!1),window.addEventListener("touchend",C,!1),window.addEventListener("pointerup",C,!1),window.addEventListener("mousemove",E,!1),window.addEventListener("touchmove",E,!1),window.addEventListener("mouseleave",S,!1),window.addEventListener("scroll",$,!0)}function u(t,e,n){return n?t.y>n.top&&t.y<n.bottom&&t.x>n.left&&t.x<n.right:a.pointInside(t,e)}t.exports=function(t,e){return new d(t,e)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=["webkit","moz","ms","o"];e.requestAnimationFrame=function(){for(var t=0,e=i.length;t<e&&!window.requestAnimationFrame;++t)window.requestAnimationFrame=window[i[t]+"RequestAnimationFrame"];var n;return window.requestAnimationFrame||(n=0,window.requestAnimationFrame=function(t){var e=(new Date).getTime(),i=Math.max(0,16-e-n),r=window.setTimeout((function(){return t(e+i)}),i);return n=e+i,r}),window.requestAnimationFrame.bind(window)}(),e.cancelAnimationFrame=function(){for(var t=0,e=i.length;t<e&&!window.cancelAnimationFrame;++t)window.cancelAnimationFrame=window[i[t]+"CancelAnimationFrame"]||window[i[t]+"CancelRequestAnimationFrame"];return window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){window.clearTimeout(t)}),window.cancelAnimationFrame.bind(window)}()},function(t,e,n){"use strict";function i(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(e,"__esModule",{value:!0});var r=i(n(21)),o=i(n(23)),s=i(n(24)),a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},l=function(t){return null!=t&&"object"===(void 0===t?"undefined":a(t))&&1===t.nodeType&&"object"===a(t.style)&&"object"===a(t.ownerDocument)};function d(t){if("string"==typeof t)try{return document.querySelector(t)}catch(t){throw t}else if(s(t))return t}function u(t,e){if(e=p(e,!0),!l(e))return-1;for(var n=0;n<t.length;n++)if(t[n]===e)return n;return-1}function c(t,e){return-1!==u(t,e)}function f(t){if(!t)return[];try{return"string"==typeof t?r(document.querySelectorAll(t)):o(t)?t.map(p):void 0===t.length?[p(t)]:r(t,p)}catch(t){throw new Error(t)}}function h(t,e){for(var n=0;n<e.length;n++)c(t,e[n])||t.push(e[n]);return e}function p(t,e){if("string"==typeof t)try{return document.querySelector(t)}catch(t){throw t}if(!l(t)&&!e)throw new TypeError(t+" is not a DOM element.");return t}e.indexOfElement=u,e.hasElement=c,e.domListOf=f,e.concatElementLists=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return t.reduce((function(t,e){return e.length?t:t.concat(f(e))}),[])},e.addElements=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];return h(t,e=e.map(p))},e.removeElements=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];return e.map(p).reduce((function(e,n){var i=u(t,n);return-1!==i?e.concat(t.splice(i,1)):e}),[])},e.resolveElement=p,e.select=d,e.selectAll=function(t){return"string"==typeof t?Array.prototype.slice.apply(document.querySelectorAll(t)):o(t)?t.map(d):"length"in t?r(t).map(d):void 0}},function(t,e,n){t.exports="function"==typeof Array.from?Array.from:n(22)},function(t,e){var n,i,r,o,s,a;t.exports=(n=function(t){return"function"==typeof t},i=Math.pow(2,53)-1,r=function(t){var e=function(t){var e=Number(t);return isNaN(e)?0:0!==e&&isFinite(e)?(e>0?1:-1)*Math.floor(Math.abs(e)):e}(t);return Math.min(Math.max(e,0),i)},o=function(t){if(null!=t){if(["string","number","boolean","symbol"].indexOf(typeof t)>-1)return Symbol.iterator;if("undefined"!=typeof Symbol&&"iterator"in Symbol&&Symbol.iterator in t)return Symbol.iterator;if("@@iterator"in t)return"@@iterator"}},s=function(t,e){if(null!=t&&null!=e){var i=t[e];if(null==i)return;if(!n(i))throw new TypeError(i+" is not a function");return i}},a=function(t){var e=t.next();return!Boolean(e.done)&&e},function(t){"use strict";var e,i,l,d=this,u=arguments.length>1?arguments[1]:void 0;if(void 0!==u){if(!n(u))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(e=arguments[2])}var c=s(t,o(t));if(void 0!==c){i=n(d)?Object(new d):[];var f,h,p=c.call(t);if(null==p)throw new TypeError("Array.from requires an array-like or iterable object");for(l=0;;){if(!(f=a(p)))return i.length=l,i;h=f.value,i[l]=u?u.call(e,h,l):h,l++}}else{var m=Object(t);if(null==t)throw new TypeError("Array.from requires an array-like object - not null or undefined");var v,g=r(m.length);for(i=n(d)?Object(new d(g)):new Array(g),l=0;l<g;)v=m[l],i[l]=u?u.call(e,v,l):v,l++;i.length=g}return i})},function(t,e){var n=Array.isArray,i=Object.prototype.toString;t.exports=n||function(t){return!!t&&"[object Array]"==i.call(t)}},function(t,e,n){"use strict";n.r(e);var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};e.default=function(t){return null!=t&&"object"===(void 0===t?"undefined":i(t))&&1===t.nodeType&&"object"===i(t.style)&&"object"===i(t.ownerDocument)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=(i=n(26))&&"object"==typeof i&&"default"in i?i.default:i;function o(t){if(t===window)return function(){var t={top:{value:0,enumerable:!0},left:{value:0,enumerable:!0},right:{value:window.innerWidth,enumerable:!0},bottom:{value:window.innerHeight,enumerable:!0},width:{value:window.innerWidth,enumerable:!0},height:{value:window.innerHeight,enumerable:!0},x:{value:0,enumerable:!0},y:{value:0,enumerable:!0}};if(Object.create)return Object.create({},t);var e={};return Object.defineProperties(e,t),e}();try{var e=t.getBoundingClientRect();return void 0===e.x&&(e.x=e.left,e.y=e.top),e}catch(e){throw new TypeError("Can't call getBoundingClientRect on "+t)}}e.createPointCB=r,e.getClientRect=o,e.pointInside=function(t,e){var n=o(e);return t.y>n.top&&t.y<n.bottom&&t.x>n.left&&t.x<n.right}},function(t,e,n){"use strict";var i=n(1);t.exports=function(t,e){e=e||{};var n=i.boolean(e.allowUpdate,!0);return function(e){if(e=e||window.event,t.target=e.target||e.srcElement||e.originalTarget,t.element=this,t.type=e.type,n(e)){if(e.targetTouches)t.x=e.targetTouches[0].clientX,t.y=e.targetTouches[0].clientY,t.pageX=e.targetTouches[0].pageX,t.pageY=e.targetTouches[0].pageY,t.screenX=e.targetTouches[0].screenX,t.screenY=e.targetTouches[0].screenY;else{if(null===e.pageX&&null!==e.clientX){var i=e.target&&e.target.ownerDocument||document,r=i.documentElement,o=i.body;t.pageX=e.clientX+(r&&r.scrollLeft||o&&o.scrollLeft||0)-(r&&r.clientLeft||o&&o.clientLeft||0),t.pageY=e.clientY+(r&&r.scrollTop||o&&o.scrollTop||0)-(r&&r.clientTop||o&&o.clientTop||0)}else t.pageX=e.pageX,t.pageY=e.pageY;t.x=e.clientX,t.y=e.clientY,t.screenX=e.screenX,t.screenY=e.screenY}t.clientX=t.x,t.clientY=t.y}}}},function(t,e,n){"use strict";var i,r=void 0;"function"!=typeof Object.create?(i=function(){},r=function(t,e){if(t!==Object(t)&&null!==t)throw TypeError("Argument must be an object, or null");i.prototype=t||{};var n=new i;return i.prototype=null,void 0!==e&&Object.defineProperties(n,e),null===t&&(n.__proto__=null),n}):r=Object.create;var o=r,s=["altKey","button","buttons","clientX","clientY","ctrlKey","metaKey","movementX","movementY","offsetX","offsetY","pageX","pageY","region","relatedTarget","screenX","screenY","shiftKey","which","x","y"];function a(t,e){e=e||{};for(var n=o(t),i=0;i<s.length;i++)void 0!==e[s[i]]&&(n[s[i]]=e[s[i]]);return n}function l(t,e){console.log("data ",e),t.data=e||{},t.dispatched="mousemove"}t.exports=function(t){var e={screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1,button:0,buttons:1,relatedTarget:null,region:null};function n(t){for(var n=0;n<s.length;n++)e[s[n]]=t[s[n]]}return void 0!==t&&t.addEventListener("mousemove",n),{destroy:function(){t&&t.removeEventListener("mousemove",n,!1),e=null},dispatch:MouseEvent?function(t,n,i){var r=new MouseEvent("mousemove",a(e,n));return l(r,i),t.dispatchEvent(r)}:"function"==typeof document.createEvent?function(t,n,i){var r=a(e,n),o=document.createEvent("MouseEvents");return o.initMouseEvent("mousemove",!0,!0,window,0,r.screenX,r.screenY,r.clientX,r.clientY,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.button,r.relatedTarget),l(o,i),t.dispatchEvent(o)}:"function"==typeof document.createEventObject?function(t,n,i){var r=document.createEventObject(),o=a(e,n);for(var s in o)r[s]=o[s];return l(r,i),t.dispatchEvent(r)}:void 0}}},function(t,e,n){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}"undefined"===i(Craft.SproutForms)&&(Craft.SproutForms={}),function(t){var e=window.MutationObserver||window.WebKitMutationObserver;e||((e=function(){}).prototype.observe=function(){},e.prototype.disconnect=function(){}),Craft.SproutForms.FieldModal=Garnish.Modal.extend({$body:null,$content:null,$main:null,$footer:null,$leftButtons:null,$rightButtons:null,$saveBtn:null,$cancelBtn:null,$deleteBtn:null,$saveSpinner:null,$deleteSpinner:null,$loadSpinner:null,addedDelete:!1,$html:null,$js:null,$css:null,$currentHtml:null,$currentJs:null,$currentCss:null,$observed:null,observer:null,templateLoaded:!1,executedJs:null,loadedCss:null,init:function(n){this.base(),this.setSettings(n,{resizable:!0}),this.$currentHtml=t(),this.$currentJs=t(),this.$currentCss=t(),this.$observed=t(),this.executedJs={},this.loadedCss={},this.observer=new e(t.proxy((function(t){for(var e=0;e<t.length;e++)this.$observed=this.$observed.add(t[e].addedNodes)}),this));var i=t('<form class="modal sprout-field-modal" style="display: none; opacity: 0;">').appendTo(Garnish.$bod);this.$body=t('<div class="body">').appendTo(i),this.$content=t('<div class="content">').appendTo(this.$body),this.$main=t('<div class="main">').appendTo(this.$content),this.$footer=t('<div class="footer">').appendTo(i),this.$loadSpinner=t('<div class="spinner big">').appendTo(i),this.$leftButtons=t('<div class="buttons left">').appendTo(this.$footer),this.$rightButtons=t('<div class="buttons right">').appendTo(this.$footer),this.$deleteSpinner=t('<div class="spinner hidden">').appendTo(this.$leftButtons),this.$deleteBtn=t('<div class="btn delete hidden" role="button">').text(Craft.t("sprout-forms","Delete")).appendTo(this.$leftButtons),this.$cancelBtn=t('<div class="btn disabled" role="button">').text(Craft.t("sprout-forms","Cancel")).appendTo(this.$rightButtons),this.$saveBtn=t('<div class="btn submit disabled" role="button">').text(Craft.t("sprout-forms","Save")).appendTo(this.$rightButtons),this.$saveSpinner=t('<div class="spinner hidden">').appendTo(this.$rightButtons),this.setContainer(i);var r={formId:t("#formId").val()};Craft.postActionRequest("sprout-forms/fields/modal-field",r,t.proxy((function(t,e){"success"===e?(this.$loadSpinner.addClass("hidden"),this.initTemplate(t)):this.destroy()}),this))},initTemplate:function(e){var n=t.proxy((function(t){this.$html=t.$html,this.$js=t.$js,this.$css=t.$css,this.templateLoaded=!0,this.initListeners(),this.visible&&this.initSettings(),this.off("parseTemplate",n)}),this);this.on("parseTemplate",n),this.parseTemplate(e)},parseTemplate:function(e){var n=this,i=Garnish.$doc.find("head"),r=t(e.html),o=t(e.js).filter("script"),s=t(e.css).filter("style, link"),a=s.filter("link").prop("async",!0),l=s.filter("style");a.each((function(){var e=t(this),r=e.prop("href");n.loadedCss.hasOwnProperty(r)||(i.append(e),n.loadedCss[r]=e)}));var d=o.filter("[src]"),u=o.filter(":not([src])"),c=[];d.each((function(){var e=t(this).prop("src");n.executedJs.hasOwnProperty(e)||(c.push(e),n.executedJs[e]=!0)}));t.when(this.runExternalScripts(c)).then(function t(){n.off("runExternalScripts",t),n.trigger("parseTemplate",{target:this,$html:r,$js:u,$css:l})}()),this.$deleteBtn.removeClass("hidden"),this.$saveBtn.removeClass("disabled"),this.$cancelBtn.removeClass("disabled")},runExternalScripts:function(e){var n=e.length;if(n>0)for(var i=0;i<e.length;i++){var r=e[i];(r.indexOf("MatrixConfigurator")>=0||r.indexOf("TableFieldSettings.min.js")>=0||r.indexOf("quill.min.js")>=0||r.indexOf("sproutfields.js")>=0||r.indexOf("EditableTable.js")>=0||r.indexOf("initialize.js")>=0)&&t.getScript(r,t.proxy((function(t,e){"success"===e?0===--n&&this.trigger("runExternalScripts",{target:this}):Craft.cp.displayError(Craft.t("sprout-forms","Could not load all resources."))}),this))}else this.trigger("runExternalScripts",{target:this})},initListeners:function(){this.$deleteBtn.addClass("hidden"),this.$cancelBtn.addClass("disabled"),this.$saveBtn.addClass("disabled"),this.addListener(this.$cancelBtn,"activate","closeModal"),this.addListener(this.$saveBtn,"activate","saveField"),this.addedDelete||(this.addListener(this.$deleteBtn,"click","deleteField"),this.addedDelete=!0),this.on("show",this.initSettings),this.on("fadeOut",this.destroySettings),this.enable()},destroyListeners:function(){this.$cancelBtn.addClass("disabled"),this.$saveBtn.addClass("disabled"),this.removeListener(this.$cancelBtn,"activate"),this.removeListener(this.$saveBtn,"activate"),this.off("show",this.initSettings),this.off("fadeOut",this.destroySettings),this.disable()},initSettings:function(e){var n=e&&e.target?e.target:this;if(n.templateLoaded){n.$currentHtml=e&&e.$html?e.$html:n.$html.clone(),n.$currentJs=e&&e.$js?e.$js:n.$js.clone(),n.$currentCss=e&&e.$css?e.$css:n.$css.clone(),n.$observed=t(),n.observer.observe(Garnish.$bod[0],{childList:!0,subtree:!1}),n.$main.append(n.$currentHtml),Garnish.$bod.append(n.$currentJs);n.$main.find('input[name="fieldId"]');Craft.initUiElements();t.when(n.runExternalScripts(Object.keys(n.executedJs))).then(function t(){n.off("runExternalScripts",t),setTimeout((function(){n.observer.disconnect()}),1)}())}},destroySettings:function(t){var e=t&&t.target?t.target:this;e.$currentHtml.remove(),e.$currentJs.remove(),e.$currentCss.remove(),e.$observed.remove()},closeModal:function(){this.hide()},saveField:function(e){if(e&&e.preventDefault(),!this.$saveBtn.hasClass("disabled")&&this.$saveSpinner.hasClass("hidden")){this.destroyListeners(),this.$saveSpinner.removeClass("hidden");var n=this.$container.serialize(),i=this.$container.find('input[name="fieldId"]'),r=!!i.length&&i.val();Craft.postActionRequest("sprout-forms/fields/save-field",n,t.proxy((function(e,n){this.$saveSpinner.addClass("hidden");var i="success"===n;if(i&&e.success)this.initListeners(),!1===r?this.trigger("newField",{target:this,field:e.field}):(this.trigger("saveField",{target:this,field:e.field}),Craft.cp.displayNotice(Craft.t("sprout-forms","'{name}' field saved.",{name:e.field.name}))),this.hide();else if(i&&e.template)if(this.visible){var o=t.proxy((function(t){this.initListeners(),this.destroySettings(),this.initSettings(t),this.off("parseTemplate",o)}),this);this.on("parseTemplate",o),this.parseTemplate(e.template),Garnish.shake(this.$container)}else this.initListeners();else this.initListeners(),Craft.cp.displayError(Craft.t("sprout-forms","An unknown error occurred."))}),this))}},editField:function(e){this.destroyListeners(),this.show(),this.initListeners(),this.$loadSpinner.removeClass("hidden");var n={fieldId:e,formId:t("#formId").val()};Craft.postActionRequest("sprout-forms/fields/edit-field",n,t.proxy((function(e,n){this.$loadSpinner.addClass("hidden");var i="success"===n;if(i&&e.success){var r=t.proxy((function(t){this.destroySettings(),this.initSettings(t),this.off("parseTemplate",r)}),this);this.on("parseTemplate",r),this.parseTemplate(e.template)}else i&&e.error?(Craft.cp.displayError(e.error),this.hide()):(Craft.cp.displayError(Craft.t("sprout-forms","An unknown error occurred. ")),this.hide())}),this))},deleteField:function(e){if(e.preventDefault(),this.confirmDeleteField()){this.destroyListeners();var n=this.$container.serialize(),i=t(this.$container).find('input[name="fieldId"]').val();Craft.postActionRequest("sprout-forms/fields/delete-field",n,t.proxy((function(e,n){"success"===n&&e.success?(Craft.cp.displayNotice(Craft.t("sprout-forms","Field deleted.")),t("#sproutfield-"+i).remove(),this.initListeners(),this.hide()):(Craft.cp.displayError(Craft.t("sprout-forms","Unable to delete field.")),this.hide())}),this))}},confirmDeleteField:function(){return confirm("Are you sure you want to delete this field and all of it's data?")},hide:function(){this._disabled||this.base()},destroy:function(){this.base.destroy(),this.destroyListeners(),this.destroySettings(),this.$shade.remove(),this.$container.remove(),this.trigger("destroy")}},{getInstance:function(){return this._instance||(this._instance=new Craft.SproutForms.FieldModal),this._instance}})}(jQuery)},function(t,e,n){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}"undefined"===i(Craft.SproutForms)&&(Craft.SproutForms={}),function(t){var e=window.MutationObserver||window.WebKitMutationObserver;e||((e=function(){}).prototype.observe=function(){},e.prototype.disconnect=function(){}),Craft.SproutForms.IntegrationModal=Garnish.Modal.extend({$body:null,$content:null,$main:null,$footer:null,$leftButtons:null,$rightButtons:null,$saveBtn:null,$cancelBtn:null,$deleteBtn:null,$saveSpinner:null,$deleteSpinner:null,$loadSpinner:null,addedDelete:!1,$html:null,$js:null,$css:null,$currentHtml:null,$currentJs:null,$currentCss:null,$observed:null,observer:null,templateLoaded:!1,executedJs:null,loadedCss:null,init:function(n){this.base(),this.setSettings(n,{resizable:!0}),this.$currentHtml=t(),this.$currentJs=t(),this.$currentCss=t(),this.$observed=t(),this.executedJs={},this.loadedCss={},this.observer=new e(t.proxy((function(t){for(var e=0;e<t.length;e++)this.$observed=this.$observed.add(t[e].addedNodes)}),this));var i=t('<form class="modal sprout-field-modal" style="display: none; opacity: 0;">').appendTo(Garnish.$bod);this.$body=t('<div class="body">').appendTo(i),this.$content=t('<div class="content">').appendTo(this.$body),this.$main=t('<div class="main">').appendTo(this.$content),this.$footer=t('<div class="footer">').appendTo(i),this.$loadSpinner=t('<div class="spinner big">').appendTo(i),this.$leftButtons=t('<div class="buttons left">').appendTo(this.$footer),this.$rightButtons=t('<div class="buttons right">').appendTo(this.$footer),this.$deleteSpinner=t('<div class="spinner hidden">').appendTo(this.$leftButtons),this.$deleteBtn=t('<div class="btn delete hidden" role="button">').text(Craft.t("sprout-forms","Delete")).appendTo(this.$leftButtons),this.$cancelBtn=t('<div class="btn disabled" role="button">').text(Craft.t("sprout-forms","Cancel")).appendTo(this.$rightButtons),this.$saveBtn=t('<div class="btn submit disabled" role="button">').text(Craft.t("sprout-forms","Save")).appendTo(this.$rightButtons),this.$saveSpinner=t('<div class="spinner hidden">').appendTo(this.$rightButtons),this.setContainer(i),this.$loadSpinner.addClass("hidden");this.initTemplate({html:"",js:"",css:""})},initTemplate:function(e){var n=t.proxy((function(t){this.$html=t.$html,this.$js=t.$js,this.$css=t.$css,this.templateLoaded=!0,this.initListeners(),this.visible&&this.initSettings(),this.off("parseTemplate",n)}),this);this.on("parseTemplate",n),this.parseTemplate(e)},parseTemplate:function(e){var n=this,i=Garnish.$doc.find("head"),r=t(e.html),o=t(e.js).filter("script"),s=t(e.css).filter("style, link"),a=s.filter("link").prop("async",!0),l=s.filter("style");a.each((function(){var e=t(this),r=e.prop("href");n.loadedCss.hasOwnProperty(r)||(i.append(e),n.loadedCss[r]=e)}));var d=o.filter("[src]"),u=o.filter(":not([src])"),c=[];d.each((function(){var e=t(this).prop("src");n.executedJs.hasOwnProperty(e)||(c.push(e),n.executedJs[e]=!0)}));t.when(this.runExternalScripts(c)).then(function t(){n.off("runExternalScripts",t),n.trigger("parseTemplate",{target:this,$html:r,$js:u,$css:l})}()),this.$deleteBtn.removeClass("hidden"),this.$saveBtn.removeClass("disabled"),this.$cancelBtn.removeClass("disabled")},runExternalScripts:function(e){var n=e.length;if(n>0)for(var i=0;i<e.length;i++){var r=e[i];(r.indexOf("MatrixConfigurator")>=0||r.indexOf("TableFieldSettings.min.js")>=0||r.indexOf("quill.min.js")>=0||r.indexOf("sproutfields.js")>=0||r.indexOf("EditableTable.js")>=0||r.indexOf("initialize.js")>=0)&&t.getScript(r,t.proxy((function(t,e){"success"===e?0===--n&&this.trigger("runExternalScripts",{target:this}):Craft.cp.displayError(Craft.t("sprout-forms","Could not load all resources."))}),this))}else this.trigger("runExternalScripts",{target:this})},initListeners:function(){this.$deleteBtn.addClass("hidden"),this.$cancelBtn.addClass("disabled"),this.$saveBtn.addClass("disabled"),this.addListener(this.$cancelBtn,"activate","closeModal"),this.addListener(this.$saveBtn,"activate","saveIntegration"),this.addedDelete||(this.addListener(this.$deleteBtn,"click","deleteIntegration"),this.addedDelete=!0),this.on("show",this.initSettings),this.on("fadeOut",this.destroySettings),this.enable()},destroyListeners:function(){this.$cancelBtn.addClass("disabled"),this.$saveBtn.addClass("disabled"),this.removeListener(this.$cancelBtn,"activate"),this.removeListener(this.$saveBtn,"activate"),this.off("show",this.initSettings),this.off("fadeOut",this.destroySettings),this.disable()},initSettings:function(e){var n=e&&e.target?e.target:this;if(n.templateLoaded){n.$currentHtml=e&&e.$html?e.$html:n.$html.clone(),n.$currentJs=e&&e.$js?e.$js:n.$js.clone(),n.$currentCss=e&&e.$css?e.$css:n.$css.clone(),n.$observed=t(),n.observer.observe(Garnish.$bod[0],{childList:!0,subtree:!1}),n.$main.append(n.$currentHtml),Garnish.$bod.append(n.$currentJs),Craft.initUiElements();t.when(n.runExternalScripts(Object.keys(n.executedJs))).then(function t(){n.off("runExternalScripts",t),setTimeout((function(){n.observer.disconnect()}),1)}())}},destroySettings:function(t){var e=t&&t.target?t.target:this;e.$currentHtml.remove(),e.$currentJs.remove(),e.$currentCss.remove(),e.$observed.remove()},closeModal:function(){this.hide()},saveIntegration:function(e){if(e&&e.preventDefault(),!this.$saveBtn.hasClass("disabled")&&this.$saveSpinner.hasClass("hidden")){this.destroyListeners(),this.$saveSpinner.removeClass("hidden");var n=this.$container.serialize(),i=this.$container.find('input[name="integrationId"]');!!i.length&&i.val();Craft.postActionRequest("sprout-forms/integrations/save-integration",n,t.proxy((function(e,n){this.$saveSpinner.addClass("hidden");var i="success"===n;if(i&&e.success)this.initListeners(),this.trigger("saveIntegration",{target:this,integration:e.integration}),Craft.cp.displayNotice(Craft.t("sprout-forms","'{name}' integration saved.",{name:e.integration.name})),this.hide();else if(i&&e.template)if(this.visible){var r=t.proxy((function(t){this.initListeners(),this.destroySettings(),this.initSettings(t),this.off("parseTemplate",r)}),this);this.on("parseTemplate",r),this.parseTemplate(e.template),Garnish.shake(this.$container)}else this.initListeners();else this.initListeners(),Craft.cp.displayError(Craft.t("sprout-forms","An unknown error occurred."))}),this))}},editIntegration:function(e){this.destroyListeners(),this.show(),this.initListeners(),this.$loadSpinner.removeClass("hidden");var n={integrationId:e,formId:t("#formId").val()};Craft.postActionRequest("sprout-forms/integrations/edit-integration",n,t.proxy((function(e,n){this.$loadSpinner.addClass("hidden");var i="success"===n;if(i&&e.success){var r=t.proxy((function(t){this.destroySettings(),this.initSettings(t),this.off("parseTemplate",r)}),this);this.on("parseTemplate",r),this.parseTemplate(e.template)}else i&&e.error?(Craft.cp.displayError(e.error),this.hide()):(Craft.cp.displayError(Craft.t("sprout-forms","An unknown error occurred. ")),this.hide())}),this))},deleteIntegration:function(e){if(e.preventDefault(),this.confirmDeleteIntegration()){this.destroyListeners();var n=this.$container.serialize(),i=t(this.$container).find('input[name="integrationId"]').val();Craft.postActionRequest("sprout-forms/integrations/delete-integration",n,t.proxy((function(e,n){"success"===n&&e.success?(Craft.cp.displayNotice(Craft.t("sprout-forms","Integration deleted.")),t("#sproutforms-integration-row-"+i).remove(),this.initListeners(),this.hide()):(Craft.cp.displayError(Craft.t("sprout-forms","Unable to delete integration.")),this.hide())}),this))}},confirmDeleteIntegration:function(){return confirm("Are you sure you want to delete this integration and all of it's settings?")},hide:function(){this._disabled||this.base()},destroy:function(){this.base.destroy(),this.destroyListeners(),this.destroySettings(),this.$shade.remove(),this.$container.remove(),this.trigger("destroy")}},{getInstance:function(){return this._instance||(this._instance=new Craft.SproutForms.IntegrationModal),this._instance}})}(jQuery)},function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var n=this;this.integrationType=void 0!==e.integrationType?e.integrationType:"",this.disableOptions(),this.updateAllFieldSelects(),this.updateTargetFieldsOnChange=void 0!==e.updateTargetFieldsOnChange?e.updateTargetFieldsOnChange:[],this.updateTargetFieldsOnChange.forEach((function(t){$(t).change((function(){n.updateAllFieldSelects()}))}))}var e,r,o;return e=t,(r=[{key:"disableOptions",value:function(){var t=this,e={integrationId:$("#integrationId").val()};return Craft.postActionRequest("sprout-forms/integrations/get-source-form-fields",e,$.proxy((function(e,n){if("success"===n&&e.success){var i=e.sourceFormFields;$("tbody .formField").each((function(e){var n=$(this);n.empty();var r=i[e].label,o=i[e].value;n.append('<div style="display:none;"><select readonly name="settings['+t.integrationType+"][fieldMapping]["+e+'][sourceFormField]"><option selected value="'+o+'">'+r+'</option></select></div><div style="padding: 7px 10px;font-size: 12px;color:#8f98a3;">'+r+' <span class="code">('+o+")</span></div>")}))}else Craft.cp.displayError(Craft.t("sprout-forms","Unable to get the Form fields"))}),this)),null}},{key:"updateAllFieldSelects",value:function(){var t="table#settings-"+this.integrationType.replace(/\\/g,"-")+"-fieldMapping tr";$(t).find("td:eq(2),th:eq(2)").remove(),$(t).find("td:eq(0),th:eq(0)").css("width","50%"),$(t).find("td:eq(1),th:eq(1)").css("width","50%");var e=this.getCurrentRows("tbody .targetFields"),n=$("#integrationId").closest("form").serialize(),i=this;Craft.postActionRequest("sprout-forms/integrations/get-target-integration-fields",n,$.proxy((function(t,n){if("success"===n&&t.success){var r=t.targetIntegrationFields;if(0===r.length)return!1;e.each((function(t){var e=$(this).find("select"),n=r[t];i.appendFieldsToSelect(e,n)}))}else Craft.cp.displayError(Craft.t("sprout-forms","Unable to get the Form fields"))}),this))}},{key:"getCurrentRows",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===t&&(t="tbody .formField"),$(t)}},{key:"appendFieldsToSelect",value:function(t,e){t.empty();var n="",r=!1;for(t.append('<option value="">'+Craft.t("sprout-forms","None")+"</option>"),i=0;i<e.length;i++){var o=e[i],s="",a=i===e.length-1;"optgroup"in o||("selected"in o&&(s="selected"),n+="<option "+s+' value="'+o.value+'">'+o.label+"</option>"),("optgroup"in o&&r||a&&r)&&(n+="</optgroup>",r=!1),"optgroup"in o&&(n+='<optgroup label="'+o.optgroup+'">',r=!0)}t.append(n)}}])&&n(e.prototype,r),o&&n(e,o),t}();window.SproutFormsIntegration=r},function(t,e,n){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}"undefined"===i(Craft.SproutForms)&&(Craft.SproutForms={}),function(t){var e=window.MutationObserver||window.WebKitMutationObserver;e||((e=function(){}).prototype.observe=function(){},e.prototype.disconnect=function(){}),Craft.SproutForms.RuleModal=Garnish.Modal.extend({$body:null,$content:null,$main:null,$footer:null,$leftButtons:null,$rightButtons:null,$saveBtn:null,$cancelBtn:null,$deleteBtn:null,$saveSpinner:null,$deleteSpinner:null,$loadSpinner:null,addedDelete:!1,$html:null,$js:null,$css:null,$currentHtml:null,$currentJs:null,$currentCss:null,$observed:null,observer:null,templateLoaded:!1,executedJs:null,loadedCss:null,init:function(n){this.base(),this.setSettings(n,{resizable:!0}),this.$currentHtml=t(),this.$currentJs=t(),this.$currentCss=t(),this.$observed=t(),this.executedJs={},this.loadedCss={},this.observer=new e(t.proxy((function(t){for(var e=0;e<t.length;e++)this.$observed=this.$observed.add(t[e].addedNodes)}),this));var i=t('<form class="modal sprout-field-modal" style="display: none; opacity: 0;">').appendTo(Garnish.$bod);this.$body=t('<div class="body">').appendTo(i),this.$content=t('<div class="content">').appendTo(this.$body),this.$main=t('<div class="main">').appendTo(this.$content),this.$footer=t('<div class="footer">').appendTo(i),this.$loadSpinner=t('<div class="spinner big">').appendTo(i),this.$leftButtons=t('<div class="buttons left">').appendTo(this.$footer),this.$rightButtons=t('<div class="buttons right">').appendTo(this.$footer),this.$deleteSpinner=t('<div class="spinner hidden">').appendTo(this.$leftButtons),this.$deleteBtn=t('<div class="btn delete hidden" role="button">').text(Craft.t("sprout-forms","Delete")).appendTo(this.$leftButtons),this.$cancelBtn=t('<div class="btn disabled" role="button">').text(Craft.t("sprout-forms","Cancel")).appendTo(this.$rightButtons),this.$saveBtn=t('<div class="btn submit disabled" role="button">').text(Craft.t("sprout-forms","Save")).appendTo(this.$rightButtons),this.$saveSpinner=t('<div class="spinner hidden">').appendTo(this.$rightButtons),this.setContainer(i),this.$loadSpinner.addClass("hidden");this.initTemplate({html:"",js:"",css:""})},initTemplate:function(e){var n=t.proxy((function(t){this.$html=t.$html,this.$js=t.$js,this.$css=t.$css,this.templateLoaded=!0,this.initListeners(),this.visible&&this.initSettings(),this.off("parseTemplate",n)}),this);this.on("parseTemplate",n),this.parseTemplate(e)},parseTemplate:function(e){var n=this,i=Garnish.$doc.find("head"),r=t(e.html),o=t(e.js).filter("script"),s=t(e.css).filter("style, link"),a=s.filter("link").prop("async",!0),l=s.filter("style");a.each((function(){var e=t(this),r=e.prop("href");n.loadedCss.hasOwnProperty(r)||(i.append(e),n.loadedCss[r]=e)}));var d=o.filter("[src]"),u=o.filter(":not([src])"),c=[];d.each((function(){var e=t(this).prop("src");n.executedJs.hasOwnProperty(e)||(c.push(e),n.executedJs[e]=!0)}));t.when(this.runExternalScripts(c)).then(function t(){n.off("runExternalScripts",t),n.trigger("parseTemplate",{target:this,$html:r,$js:u,$css:l})}()),this.$deleteBtn.removeClass("hidden"),this.$saveBtn.removeClass("disabled"),this.$cancelBtn.removeClass("disabled")},runExternalScripts:function(e){var n=e.length;if(n>0)for(var i=0;i<e.length;i++){var r=e[i];(r.indexOf("MatrixConfigurator")>=0||r.indexOf("TableFieldSettings.min.js")>=0||r.indexOf("quill.min.js")>=0||r.indexOf("sproutfields.js")>=0||r.indexOf("EditableTable.js")>=0||r.indexOf("initialize.js")>=0)&&t.getScript(r,t.proxy((function(t,e){"success"===e?0===--n&&this.trigger("runExternalScripts",{target:this}):Craft.cp.displayError(Craft.t("sprout-forms","Could not load all resources."))}),this))}else this.trigger("runExternalScripts",{target:this})},initListeners:function(){this.$deleteBtn.addClass("hidden"),this.$cancelBtn.addClass("disabled"),this.$saveBtn.addClass("disabled"),this.addListener(this.$cancelBtn,"activate","closeModal"),this.addListener(this.$saveBtn,"activate","saveRule"),this.addedDelete||(this.addListener(this.$deleteBtn,"click","deleteRule"),this.addedDelete=!0),this.on("show",this.initSettings),this.on("fadeOut",this.destroySettings),this.enable()},destroyListeners:function(){this.$cancelBtn.addClass("disabled"),this.$saveBtn.addClass("disabled"),this.removeListener(this.$cancelBtn,"activate"),this.removeListener(this.$saveBtn,"activate"),this.off("show",this.initSettings),this.off("fadeOut",this.destroySettings),this.disable()},initSettings:function(e){var n=e&&e.target?e.target:this;if(n.templateLoaded){n.$currentHtml=e&&e.$html?e.$html:n.$html.clone(),n.$currentJs=e&&e.$js?e.$js:n.$js.clone(),n.$currentCss=e&&e.$css?e.$css:n.$css.clone(),n.$observed=t(),n.observer.observe(Garnish.$bod[0],{childList:!0,subtree:!1}),n.$main.append(n.$currentHtml),Garnish.$bod.append(n.$currentJs),Craft.initUiElements();t.when(n.runExternalScripts(Object.keys(n.executedJs))).then(function t(){n.off("runExternalScripts",t),setTimeout((function(){n.observer.disconnect()}),1)}())}},destroySettings:function(t){var e=t&&t.target?t.target:this;e.$currentHtml.remove(),e.$currentJs.remove(),e.$currentCss.remove(),e.$observed.remove()},closeModal:function(){this.hide()},saveRule:function(e){if(e&&e.preventDefault(),!this.$saveBtn.hasClass("disabled")&&this.$saveSpinner.hasClass("hidden")){this.destroyListeners(),this.$saveSpinner.removeClass("hidden");var n=this.$container.serialize(),i=this.$container.find('input[name="ruleId"]');!!i.length&&i.val();Craft.postActionRequest("sprout-forms/rules/save-rule",n,t.proxy((function(e,n){this.$saveSpinner.addClass("hidden");var i="success"===n;if(i&&e.success)this.initListeners(),this.trigger("saveRule",{target:this,rule:e.rule}),Craft.cp.displayNotice(Craft.t("sprout-forms","'{name}' rule saved.",{name:e.rule.name})),this.hide();else if(i&&e.template)if(this.visible){var r=t.proxy((function(t){this.initListeners(),this.destroySettings(),this.initSettings(t),this.off("parseTemplate",r)}),this);this.on("parseTemplate",r),this.parseTemplate(e.template),Garnish.shake(this.$container)}else this.initListeners();else this.initListeners(),Craft.cp.displayError(Craft.t("sprout-forms","An unknown error occurred."))}),this))}},editRule:function(e){this.destroyListeners(),this.show(),this.initListeners(),this.$loadSpinner.removeClass("hidden");var n={ruleId:e,formId:t("#formId").val()};Craft.postActionRequest("sprout-forms/rules/edit-rule",n,t.proxy((function(e,n){this.$loadSpinner.addClass("hidden");var i="success"===n;if(i&&e.success){var r=t.proxy((function(t){this.destroySettings(),this.initSettings(t),this.off("parseTemplate",r)}),this);this.on("parseTemplate",r),this.parseTemplate(e.template)}else i&&e.error?(Craft.cp.displayError(e.error),this.hide()):(Craft.cp.displayError(Craft.t("sprout-forms","An unknown error occurred. ")),this.hide())}),this))},deleteRule:function(e){if(e.preventDefault(),this.confirmDeleteRule()){this.destroyListeners();var n=this.$container.serialize(),i=t(this.$container).find('input[name="ruleId"]').val();Craft.postActionRequest("sprout-forms/rules/delete-rule",n,t.proxy((function(e,n){"success"===n&&e.success?(Craft.cp.displayNotice(Craft.t("sprout-forms","Rule deleted.")),t("#sproutforms-rules-row-"+i).remove(),this.initListeners(),this.hide()):(Craft.cp.displayError(Craft.t("sprout-forms","Unable to delete rule.")),this.hide())}),this))}},confirmDeleteRule:function(){return confirm("Are you sure you want to delete this rule and all of it's settings?")},hide:function(){this._disabled||this.base()},destroy:function(){this.base.destroy(),this.destroyListeners(),this.destroySettings(),this.$shade.remove(),this.$container.remove(),this.trigger("destroy")}},{getInstance:function(){return this._instance||(this._instance=new Craft.SproutForms.RuleModal),this._instance}})}(jQuery)},,,,,,,,,,,,function(t,e){},,,,,function(t,e){},,,function(t,e){}]);
//# sourceMappingURL=sproutforms-cp.js.map